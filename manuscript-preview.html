<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  lang="en"
  xml:lang="en"
  >
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="quarto-1.5.37" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />


    <title>Probabilistic Model of Bilateral Lymphatic Spread in Head and Neck Cancer</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      /* CSS for citations */
      div.csl-bib-body { }
      div.csl-entry {
        clear: both;
        margin-bottom: 0em;
      }
      .hanging-indent div.csl-entry {
        margin-left:2em;
        text-indent:-2em;
      }
      div.csl-left-margin {
        min-width:2em;
        float:left;
      }
      div.csl-right-inline {
        margin-left:2em;
        padding-left:1em;
      }
      div.csl-indent {
        margin-left: 2em;
      }    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    <!-- htmldependencies:E3FAD763 -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous" data-relocate-top="true"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>   <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script> 
      </head>

  <body>
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link"><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Article Notebook</h6>

            <a
        href="manuscript.qmd"
        class="btn btn-primary quarto-download-embed"
        data-noresolveinput="true"
        download="manuscript.qmd"
        >Download Source</a
      >
          </div>

     <div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <div id="quarto-toc-target"></div>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">      <header id="title-block-header" class="quarto-title-block default toc-left">
  <div class="quarto-title-banner">
    <div class="quarto-title column-body">
      <h1 class="title">Probabilistic Model of Bilateral Lymphatic Spread in Head and Neck Cancer</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Authors</div>
          <div class="quarto-title-meta-heading">Affiliations</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Roman Ludwig <a href="mailto:roman.ludwig@usz.ch" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0001-9434-328X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University of Zurich
                      </p>
                    <p class="affiliation">
                        University Hospital Zurich
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Yoel Perez Haas <a href="mailto:yoel.perezhaas@usz.ch" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University of Zurich
                      </p>
                    <p class="affiliation">
                        University Hospital Zurich
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Jan Unkelbach <a href="mailto:jan.unkelbach@usz.ch" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-4275-990X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University of Zurich
                      </p>
                    <p class="affiliation">
                        University Hospital Zurich
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>In current practice, large parts of the contralateral lymph system are included in the elective clinical target volume (CTV-N) of oropharyngeal squamous cell carcinoma (OPSCC) patients. Guidelines on how to define the CTV-N are mostly based on prevalences of nodal involvement in the different lymph node levels (LNLs) and do not consider the detailed, individual diagnosis of a patient.</p>
        <p>In this work, we present a probabilistic model for bilateral lymphatic tumor progression in OPSCC. Its aim is to predict the personal risk for occult disease in any LNL, given the patient’s clincal diagnosis, T-category, and lateralization of the primary tumor. The model represents each of the LNLs I, II, III, IV, V, and VII of both sides of the neck as a hidden binary random variable that are connected to the tumor and among each other via arcs that correspond to spread probabilities per time-step. These spread probability rates are learned via Markov chain Monte Carlo (MCMC) sampling from a dataset of 833 OPSCC patients.</p>
        <p>The model is able to describe the data well and may in the future be used to only include LNLs in a CTV-N that show a risk above a specific threshold for that particular patient’s diagnosis. E.g., it predicts the risk for occult disease in contralateral LNL II to be below 5% unless the tumor crosses the mid-sagittal line.</p>
      </div>
    </div>


    <div class="quarto-other-links-text-target">
    </div>  </div>
</header>

     <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#marginalizing-beta-posteriors-over-unknowns" id="toc-marginalizing-beta-posteriors-over-unknowns">Marginalizing Beta Posteriors over Unknowns</a></li>
  </ul>
</nav>  <div id="39cd1735" class="cell" data-execution_count="2">
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> ticker</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> LinearSegmentedColormap</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> upsetplot</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lymph <span class="im">import</span> models</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lyscripts <span class="im">import</span> utils</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lyscripts.plot.utils <span class="im">import</span> COLORS</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scripts <span class="im">import</span> shared, paths, COL, get_lnl_cols</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>simple_model <span class="op">=</span> shared.get_model(<span class="st">&quot;simple&quot;</span>, load_samples<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div id="82c6650c" class="cell" data-tags="[&quot;parameters&quot;]" data-execution_count="3">
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># width of figures. May depend on number of text columns</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>full <span class="op">=</span> <span class="dv">17</span> <span class="co"># cm</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>half <span class="op">=</span> full</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># half =  8 # cm</span></span></code></pre></div>
</div>
<div id="8671691b" class="cell markdown">
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>When treating head and neck squamous cell carcinomas (HNSCC) with radiotherapy or surgery, not only the primary tumor and the clinically detected lymph node metastases are targeted. Per current guidelines, large volumes of the neck - lymph node levels (LNLs) - are part of the the elective clinical target volume (CTV-N) <span class="citation" data-cites="gregoire_ct-based_2003 gregoire_delineation_2014 gregoire_delineation_2018 eisbruch_intensity-modulated_2002 biau_selection_2019 chao_determination_2002 vorwerk_guidelines_2011 ferlito_elective_2009">(<a href="#ref-gregoire_ct-based_2003" role="doc-biblioref">Vincent Grégoire et al. 2003</a>, <a href="#ref-gregoire_delineation_2014" role="doc-biblioref">2014</a>; <a href="#ref-gregoire_delineation_2018" role="doc-biblioref">V. Grégoire and Others 2018</a>; <a href="#ref-eisbruch_intensity-modulated_2002" role="doc-biblioref">Eisbruch et al. 2002</a>; <a href="#ref-biau_selection_2019" role="doc-biblioref">Biau et al. 2019</a>; <a href="#ref-chao_determination_2002" role="doc-biblioref">Chao et al. 2002</a>; <a href="#ref-vorwerk_guidelines_2011" role="doc-biblioref">Vorwerk and Hess 2011</a>; <a href="#ref-ferlito_elective_2009" role="doc-biblioref">Ferlito, Silver, and Rinaldo 2009</a>)</span>. This is to minimize the risk of regional recurrences due to missed microscopic disease which cannot be detected by current in-vivo imaging modalities such as computed tomography (CT), magnetic resonance imaging (MRI), or positron emission tomography (PET).</p>
<p>Minimizing this risk of missing occult disease in the lymph drainage region must be balanced against the toxicity related to unnecessary treatment of healthy tissue.</p>
<p>The aforementioned guidelines for the definition of the CTV-N quantify this risk via the overall prevalence of lymph node metastases in the LNLs. Based on this, they recommend extensive irradiation of both sides of the neck for a majority of patients. However, this prevalence the guidelines are based on does not take into account the individual state of tumor progression, which may have a great impact on a patient’s personal risk for occult disease in a given LNL. For example, a patient with substantial nodal involvement in the ipsilateral side and an advanced primary tumor that crosses the mid-sagittal plane would receive extensive elective irradiation of the contralateral LNLs II, III, and IVa. However, if the patient presented with no clinically detectable nodal disease (cN0) and only a small, clearly lateralized T1 tumor, the same contralateral CTV-N would be recommended <span class="citation" data-cites="biau_selection_2019">(<a href="#ref-biau_selection_2019" role="doc-biblioref">Biau et al. 2019</a>)</span>.</p>
<p>To better quantify this personalized risk we have previously developed an intuitive, probabilistic hidden Markov model <span class="citation" data-cites="ludwig_hidden_2021 ludwig_modelling_2023">(<a href="#ref-ludwig_hidden_2021" role="doc-biblioref">Ludwig et al. 2021</a>; <a href="#ref-ludwig_modelling_2023" role="doc-biblioref">Ludwig, Schubert, Barbatei, Bauwens, Hoffmann, et al. 2023</a>)</span> which was originally based on a conceptually similar Bayesian network model <span class="citation" data-cites="pouymayou_bayesian_2019">(<a href="#ref-pouymayou_bayesian_2019" role="doc-biblioref">Pouymayou et al. 2019</a>)</span>. So far, these models were limited to the ipsilateral side of the neck. The main focus of this work will be to extend the formalism of these previous works to include risk predictions for the contralateral side as well. We believe this holds the potential to greatly reduce the electively irradiated volumes in the contralateral neck for patients whose individual risk for occult disease in that side is low. In turn, this may substantially reduce the toxicity from irradiation and the associated decrease in quality of life.</p>
<p>In the following, we begin by inspecting the dataset the model is built upon (<a href="#sec-data" class="quarto-xref">section 2</a>) and from it formulate some properties we require the bilateral model extension to have (<a href="#sec-requirements" class="quarto-xref">section 2.2</a>).</p>
<p>After that, in <a href="#sec-unilateral" class="quarto-xref">section 3</a>, we briefly summarize the original model formalism before we extend it to the contralateral side starting in <a href="#sec-ext-to-contra" class="quarto-xref">section 4</a>.</p>
<p>Next, we describe how the model training and the computational experiments were set up in <a href="#sec-methods" class="quarto-xref">section 5</a> and present the results in <a href="#sec-results" class="quarto-xref">section 6</a>, followed by a closing discussion (<a href="#sec-discussion" class="quarto-xref">section 7</a>).</p>
</section>
<section id="sec-data" class="level1">
<h1>Data on Lymphatic Progression Patterns</h1>
<p>Originally, the only available data of detailed - i.e. per patient and per LNL - lymphatic involvement was a reconstructed table from the findings in <span class="citation" data-cites="sanguineti_defining_2009">Sanguineti and Others (<a href="#ref-sanguineti_defining_2009" role="doc-biblioref">2009</a>)</span>, which included only ipsilateral nodal involvement for the LNLs I to IV.</p>
<p>To be able to create models for lymphatic tumor progression that include more LNLs and the contralateral side, we have collected a detailed dataset of 833<!-- num patients --> patients with newly diagnosed oropharyngeal squamous cell carcinomas. It reports the involvement of every patient individually and per lymph node level in tabular form, in addition to other clinico-pathological information such as age, T-category, and HPV p16 status.</p>
<p>Their patient records have been collected at four different institutions and a brief overview over some of their patients’ characteristics are shown in <a href="#tbl-data-overview" class="quarto-xref">table 1</a>. Note that the data from the Inselspital Bern and the Centre Léon Bérard only consists of patients treated with some form of neck dissection. Since this treatment is more commonly chosen for early T-category patients, they also make up a larger portion of the respective dataset.</p>
</section>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode" id="cb3"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Literal</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> align(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  column: pd.Series,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  where: Literal[<span class="st">&quot;right&quot;</span>, <span class="st">&quot;left&quot;</span>, <span class="st">&quot;center&quot;</span>],</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">str</span>]:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Align a column.&quot;&quot;&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="ss">f&quot;text-align: </span><span class="sc">{</span>where<span class="sc">}</span><span class="ss">&quot;</span>] <span class="op">*</span> <span class="bu">len</span>(column)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> right_align(column: pd.Series) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">str</span>]:</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Right align column.&quot;&quot;&quot;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> align(column, where<span class="op">=</span><span class="st">&quot;right&quot;</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> highlight(column: pd.Series, mapping: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">str</span>]:</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Color based on `mapping`.&quot;&quot;&quot;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  colors <span class="op">=</span> column.<span class="bu">map</span>(mapping)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> colors.<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f&quot;color: </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> highlight_bool(</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  column: pd.Series,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  c_false: <span class="bu">str</span> <span class="op">=</span> COLORS[<span class="st">&quot;green&quot;</span>],</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  c_true: <span class="bu">str</span> <span class="op">=</span> COLORS[<span class="st">&quot;red&quot;</span>],</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">str</span>]:</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Make cell read (`False`) or green (`True`).&quot;&quot;&quot;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> highlight(column, mapping<span class="op">=</span>{<span class="va">True</span>: c_true, <span class="va">False</span>: c_false})</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> highlight_t_stage(</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  column: pd.Series,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  c_early: <span class="bu">str</span> <span class="op">=</span> COLORS[<span class="st">&quot;green&quot;</span>],</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  c_late: <span class="bu">str</span> <span class="op">=</span> COLORS[<span class="st">&quot;red&quot;</span>],</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">str</span>]:</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Highlight `early` and `late`.&quot;&quot;&quot;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  is_early <span class="op">=</span> column <span class="op">==</span> <span class="st">&quot;early&quot;</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> highlight_bool(is_early, c_false<span class="op">=</span>c_late, c_true<span class="op">=</span>c_early)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>col_map <span class="op">=</span> {</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  COL.inst: <span class="st">&quot;Institution&quot;</span>,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  COL.age: <span class="st">&quot;Age&quot;</span>,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  COL.nd: <span class="st">&quot;Neck Dissection&quot;</span>,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  COL.t_stage: <span class="st">&quot;T-category&quot;</span>,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  COL.n_stage: <span class="st">&quot;N-category&quot;</span>,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>short_col_map <span class="op">=</span> {tpl[<span class="op">-</span><span class="dv">1</span>]: val <span class="cf">for</span> tpl, val <span class="kw">in</span> col_map.items()}</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>raw <span class="op">=</span> utils.load_patient_data(paths.data)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>subdata <span class="op">=</span> raw[col_map.keys()]</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>subdata.columns <span class="op">=</span> subdata.columns.get_level_values(<span class="dv">2</span>)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>subdata <span class="op">=</span> (</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  subdata</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  .rename(columns<span class="op">=</span>short_col_map)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> n0_mean(n_stage: pd.Series) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Compute portion of N0 patients.&quot;&quot;&quot;</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (n_stage <span class="op">==</span> <span class="dv">0</span>).mean()</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> early_mean(t_stage: pd.Series) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Compute early T-category portion.&quot;&quot;&quot;</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> t_stage.isin([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>]).mean()</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> (</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  raw.groupby(</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span>COL.inst,</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  ).aggregate(<span class="op">**</span>{</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Total&quot;</span>: pd.NamedAgg(column<span class="op">=</span>COL.age, aggfunc<span class="op">=</span><span class="st">&quot;count&quot;</span>),</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Age (median)&quot;</span>: pd.NamedAgg(column<span class="op">=</span>COL.age, aggfunc<span class="op">=</span><span class="st">&quot;median&quot;</span>),</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Neck Dissection&quot;</span>: pd.NamedAgg(column<span class="op">=</span>COL.nd, aggfunc<span class="op">=</span><span class="st">&quot;mean&quot;</span>),</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;N0&quot;</span>: pd.NamedAgg(column<span class="op">=</span>COL.n_stage, aggfunc<span class="op">=</span>n0_mean),</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Early T-Cat.&quot;</span>: pd.NamedAgg(column<span class="op">=</span>COL.t_stage, aggfunc<span class="op">=</span>early_mean),</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Mid. Ext.&quot;</span>: pd.NamedAgg(column<span class="op">=</span>COL.midext, aggfunc<span class="op">=</span><span class="st">&quot;mean&quot;</span>),</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  }).convert_dtypes()</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>grouped.index.name <span class="op">=</span> <span class="st">&quot;Institution&quot;</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>  grouped</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>  .reset_index()</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  .style</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">format</span>(</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    formatter<span class="op">=</span><span class="st">&quot;</span><span class="sc">{:&gt;.0%}</span><span class="st">&quot;</span>,</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span>[<span class="st">&quot;Neck Dissection&quot;</span>, <span class="st">&quot;N0&quot;</span>, <span class="st">&quot;Early T-Cat.&quot;</span>, <span class="st">&quot;Mid. Ext.&quot;</span>],</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">apply</span>(</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    func<span class="op">=</span>right_align,</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="st">&quot;index&quot;</span>,</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    subset<span class="op">=</span>grouped.columns[<span class="dv">0</span>:],</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>  .hide()</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="tbl-data-overview" class="cell quarto-float quarto-figure quarto-figure-center" data-execution_count="4">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-data-overview-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 1: Overview over the five datasets from four different institutions used to train and evaluate our model. Here, we briefly characterize the total number of OPSCC patients from the respective institution, their median age, what proportion received some form of neck dissection, the N0 portion of patients, what percentage presented with early T-category, and the prevalence of primary tumor midline extension. For a much more detailed look at the data, visit <a href="https://lyprox.org">lyprox.org</a>.
</figcaption>
<div aria-describedby="tbl-data-overview-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="3">
<style type="text/css">
#T_311df_row0_col1, #T_311df_row0_col2, #T_311df_row0_col3, #T_311df_row0_col4, #T_311df_row0_col5, #T_311df_row0_col6, #T_311df_row1_col1, #T_311df_row1_col2, #T_311df_row1_col3, #T_311df_row1_col4, #T_311df_row1_col5, #T_311df_row1_col6, #T_311df_row2_col1, #T_311df_row2_col2, #T_311df_row2_col3, #T_311df_row2_col4, #T_311df_row2_col5, #T_311df_row2_col6, #T_311df_row3_col1, #T_311df_row3_col2, #T_311df_row3_col3, #T_311df_row3_col4, #T_311df_row3_col5, #T_311df_row3_col6 {
  text-align: right;
}
</style>

<table id="T_311df" class="do-not-create-environment cell" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_311df_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Institution</th>
<th id="T_311df_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Total</th>
<th id="T_311df_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Age (median)</th>
<th id="T_311df_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Neck Dissection</th>
<th id="T_311df_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">N0</th>
<th id="T_311df_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">Early T-Cat.</th>
<th id="T_311df_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">Mid. Ext.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_311df_row0_col0" class="data row0 col0">Centre Léon Bérard</td>
<td id="T_311df_row0_col1" class="data row0 col1">325</td>
<td id="T_311df_row0_col2" class="data row0 col2">60</td>
<td id="T_311df_row0_col3" class="data row0 col3">100%</td>
<td id="T_311df_row0_col4" class="data row0 col4">19%</td>
<td id="T_311df_row0_col5" class="data row0 col5">69%</td>
<td id="T_311df_row0_col6" class="data row0 col6">18%</td>
</tr>
<tr class="even">
<td id="T_311df_row1_col0" class="data row1 col0">Inselspital Bern</td>
<td id="T_311df_row1_col1" class="data row1 col1">74</td>
<td id="T_311df_row1_col2" class="data row1 col2">61</td>
<td id="T_311df_row1_col3" class="data row1 col3">100%</td>
<td id="T_311df_row1_col4" class="data row1 col4">18%</td>
<td id="T_311df_row1_col5" class="data row1 col5">66%</td>
<td id="T_311df_row1_col6" class="data row1 col6">14%</td>
</tr>
<tr class="odd">
<td id="T_311df_row2_col0" class="data row2 col0">University Hospital Zurich</td>
<td id="T_311df_row2_col1" class="data row2 col1">287</td>
<td id="T_311df_row2_col2" class="data row2 col2">66</td>
<td id="T_311df_row2_col3" class="data row2 col3">26%</td>
<td id="T_311df_row2_col4" class="data row2 col4">18%</td>
<td id="T_311df_row2_col5" class="data row2 col5">52%</td>
<td id="T_311df_row2_col6" class="data row2 col6">31%</td>
</tr>
<tr class="even">
<td id="T_311df_row3_col0" class="data row3 col0">Vall d'Hebron Barcelona Hospital</td>
<td id="T_311df_row3_col1" class="data row3 col1">147</td>
<td id="T_311df_row3_col2" class="data row3 col2">58</td>
<td id="T_311df_row3_col3" class="data row3 col3">5%</td>
<td id="T_311df_row3_col4" class="data row3 col4">21%</td>
<td id="T_311df_row3_col5" class="data row3 col5">34%</td>
<td id="T_311df_row3_col6" class="data row3 col6">34%</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div id="852efd03" class="cell markdown">
<section id="sec-data-strat" class="level2">
<h2>Contralateral Involvement Prevalence</h2>
<p>These datasets allow us to investigate correlations between the involvement of individual LNLs, or between risk factors and patterns of involvement. In <a href="#fig-data-strat" class="quarto-xref">figure 1</a>, we have plotted the prevalence of each contralateral LNL’s involvement, stratified by T-category, ipsilateral number of involved LNLs, and whether the tumor extended over the mid-sagittal line. A similar but more complete stratification is also tabulated in the appendix in <a href="#tbl-data-strat" class="quarto-xref">table 3</a>.</p>
<div id="fig-data-strat" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-data-strat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-data-strat.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure 1: Contralateral involvement stratified by T-category (left panel), the number of metastatic LNLs ipsilaterally (center panel), and whether the primary tumor extended over the mid-sagittal line or was clearly lateralized (right panel)."><img src="figures/fig-data-strat.svg" class="img-fluid" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-data-strat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1: Contralateral involvement stratified by T-category (left panel), the number of metastatic LNLs ipsilaterally (center panel), and whether the primary tumor extended over the mid-sagittal line or was clearly lateralized (right panel).
</figcaption>
</figure>
</div>
<p>The left panel in <a href="#fig-data-strat" class="quarto-xref">figure 1</a> indicates that T-category is correlated with contralateral involvement (as it is with overal involvement). This is simply because T-category may on average be considered a surrogate for the time between onset of disease and diagnosis. I.e., a patient with a T4 tumor was – on average – diagnosed later than a patient with a T1 tumor. Thus, the former did have more time to develop metastases.</p>
<p>Similarly, ipsilateral involvement correlates with contralateral metastasis. The tumor of a patients with many metastases in ipsilateral LNLs was probably able to spread for longer (or faster) compared to a tumor in a patient with no nodal disease. This, too, may therefore be considered a surrogate for the duration of the disease. In rare cases, bulky nodal disease ipsilaterally may also redirect lymph fluids to the contralateral side. <!-- citation needed? --></p>
<p>Lastly, the right panel in <a href="#fig-data-strat" class="quarto-xref">figure 1</a> shows that patients with a tumor crossing the mid-sagittal line show contralateral involvement vastly more often compared to patients with clearly lateralized tumors. This makes intutitive sense, because the lymphatic system in the head and neck region is typically symmetric and thus no major vessels cross the midline. Therefore, interstitial fluids from the primary tumor – which we assume to carry living malignant cells – may only reach the blind-ended lymphatic vessels in the contralateral neck via short-ranged diffusion. Which in turn is only possible when the primary tumor is close enough to the mid-sagittal line or crosses it. <!-- citation(s) needed? or is this intuition good enough? --></p>
</section>
<section id="sec-requirements" class="level2">
<h2>Requirements for a Bilateral Model</h2>
<p>Based on the observations of the <a href="#sec-data-strat">previous section</a>, any potential model that aims to also predict the risk for contralateral nodal involvement, should be able to take the following into account:</p>
<ol type="1">
<li>More advanced T-category should lead to higher risk for nodal disease. One approach to achieve this via the expected time of diagnosis has already been developed in the form of a hidden Markov model <span class="citation" data-cites="ludwig_hidden_2021">(<a href="#ref-ludwig_hidden_2021" role="doc-biblioref">Ludwig et al. 2021</a>)</span>.</li>
<li>The degree of ipsilateral involvement should give the model information on the time that may have passed between onset and diagnosis of the disease. This should come in addition to what can be inferred about this time from T-category alone.</li>
<li>A tumor that extends over the mid-sagittal line should yield contralateral metastases with much higher probability.</li>
</ol>
<p>Over the course of this work, we will first briefly recap the mentioned HMM in <a href="#sec-unilateral" class="quarto-xref">section 3</a>, which was so far used to model ipsilateral lymphatic progression only. Then, we intuitively extend it to include the contralateral side as well in <a href="#sec-ext-to-contra" class="quarto-xref">section 4</a>. In this section, we also introduce a way of modelling the tumor’s midline extension as a random variable (<a href="#sec-midline" class="quarto-xref">section 4.2</a>) and lastly talk about how it may affect the contralateral spread in <a href="#sec-params-symmetry" class="quarto-xref">section 4.1</a>.</p>
<!-- TODO: Hint at methods and results... -->
</section>
<section id="data-availability" class="level2">
<h2>Data Availability</h2>
<p>The entire data, including additional patients with tumors in other primary locations than the oropharynx, is publicly available: It may be <a href="https://lyprox.org/patients/dataset">downloaded from LyProX</a> where it can be interactively explored too, <a href="https://github.com/rmnldwg/lydata">from GitHub</a>, <a href="https://zenodo.org/search?q=lydata">from zenodo</a>, or via the <em>Data-in-Brief</em> publications <span class="citation" data-cites="ludwig_dataset_2022">Ludwig et al. (<a href="#ref-ludwig_dataset_2022" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="ludwig_multi-centric_2023">Ludwig, Schubert, Barbatei, Bauwens, Werlen, et al. (<a href="#ref-ludwig_multi-centric_2023" role="doc-biblioref">2023</a>)</span>. Although these publications do not include the most recent dataset addition from Vall d’Hebron Barcelona Hospital.</p>
</section>
<section id="sec-unilateral" class="level1">
<h1>Unilateral Model for Lymphatic Progression</h1>
<div id="fig-small-graph" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-small-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="static/small-graph.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure 2: Directed acyclic graph (DAG) representing the abstract lymphatic network in the head and neck region. Blue nodes are the LNLs’ hidden random variables, the red node represents the tumor, and the orange square nodes depict the binary observed variables. Red and blue arcs symbolize the probability of lymphatic spread along that edge during one time-step. The orange arcs represent the sensitivity and specificity of the observational modality (e.g. CT, MRI, pathology, …)."><img src="static/small-graph.svg" class="img-fluid" style="width:40.0%" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-small-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 2: Directed acyclic graph (DAG) representing the abstract lymphatic network in the head and neck region. Blue nodes are the LNLs’ hidden random variables, the red node represents the tumor, and the orange square nodes depict the binary observed variables. Red and blue arcs symbolize the probability of lymphatic spread along that edge during one time-step. The orange arcs represent the sensitivity and specificity of the observational modality (e.g. CT, MRI, pathology, …).
</figcaption>
</figure>
</div>
<p>Our first model to predict the lymphatic progression of HNSCC was introduced using Bayesian networks <span class="citation" data-cites="pouymayou_bayesian_2019">(<a href="#ref-pouymayou_bayesian_2019" role="doc-biblioref">Pouymayou et al. 2019</a>)</span>. We subsequently extended this work to a hidden Markov model (HMM) <span class="citation" data-cites="ludwig_hidden_2021">(<a href="#ref-ludwig_hidden_2021" role="doc-biblioref">Ludwig et al. 2021</a>)</span> to allow an intuitive inclusion of T-category into the predictions. We will briefly summarize this HMM’s formalism before building on it to include the contralateral spread in <a href="#sec-ext-to-contra" class="quarto-xref">section 4</a>.</p>
<p>We model a patient’s state of involvement at an abstract time-step <span class="math inline">\(t\)</span> as a vector of hidden binary random variables:</p>
<p><span id="eq-state-def"><span class="math display">\[
\mathbf{X}[t] = \begin{pmatrix} X_v[t] \end{pmatrix} \qquad v \in \left\{ 1, 2, \ldots, V \right\}
\tag{1}\]</span></span></p>
<p>Here, <span class="math inline">\(V\)</span> is the number of LNLs the model considers. The values a LNL’s hidden binary RV may take on are <span class="math inline">\(X_v[t] = 0\)</span> (<code>False</code>), meaning the LNL <span class="math inline">\(v\)</span> is healthy or free of metastatic disease, or <span class="math inline">\(X_v[t] = 1\)</span> (<code>True</code>), corresponding to some for of tumor presence (i.e., occult or clinical).</p>
<p>Since the state vector <span class="math inline">\(\mathbf{X}[t]\)</span> is <span class="math inline">\(V\)</span>-dimensional and binary, there are <span class="math inline">\(2^V\)</span> distinct possible lymphatic involvement patterns, which we enumerate from <span class="math inline">\(\boldsymbol{\xi}_0 = \begin{pmatrix} 0 &amp; 0 &amp; \cdots &amp; 0 \end{pmatrix}\)</span> to <span class="math inline">\(\boldsymbol{\xi}_{2^V} = \begin{pmatrix} 1 &amp; 1 &amp; \cdots &amp; 1 \end{pmatrix}\)</span>.</p>
<p>Any hidden Markov model is fully described by three quantities:</p>
<ol type="1">
<li>A starting state <span class="math inline">\(\mathbf{X}[t=0]\)</span> at time <span class="math inline">\(t=0\)</span> just before the patient’s tumor formed. In our case, this is always the state where all LNLs are still healthy <span class="math inline">\(\boldsymbol{\xi}_0\)</span>.</li>
<li>The <em>transition matrix</em> <span id="eq-trans-matrix"><span class="math display">\[
\mathbf{A} = \left( A_{ij} \right) = \big( P \left( \mathbf{X}[t+1] = \boldsymbol{\xi}_j \mid \mathbf{X}[t] = \boldsymbol{\xi}_i \right) \big)
\tag{2}\]</span></span> where the value at row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span> represents the probability to transition from state <span class="math inline">\(\boldsymbol{\xi}_i\)</span> to <span class="math inline">\(\boldsymbol{\xi}_j\)</span> during the time-step from <span class="math inline">\(t\)</span> to <span class="math inline">\(t+1\)</span>. Note that we prohibit self-healing, meaning that during a transition, no LNL may change their state from <span class="math inline">\(X_v[t]=1\)</span> to <span class="math inline">\(X_v[t+1]=0\)</span>. This effectively masks large parts of the transition matrix to be zero.</li>
<li>Lastly, the <em>observation matrix</em> <span id="eq-obs-matrix"><span class="math display">\[
\mathbf{B} = \left( B_{ij} \right) = \big( P \left( \mathbf{Z} = \boldsymbol{\zeta}_j \mid \mathbf{X}[t_D] = \boldsymbol{\xi}_i \right) \big)
\tag{3}\]</span></span> where in row <span class="math inline">\(i\)</span> and at column <span class="math inline">\(j\)</span> we find the probability to <em>observe</em> a lymphatic involvement pattern <span class="math inline">\(\mathbf{Z} = \boldsymbol{\zeta}_j\)</span>, given that the true (but hidden) state of involvement at the time of diagnosis <span class="math inline">\(t_D\)</span> is <span class="math inline">\(\mathbf{X}[t_D] = \boldsymbol{\xi}_i\)</span>.</li>
</ol>
<p>Note that the transition matrix <span class="math inline">\(\mathbf{A}\)</span> is parametrized using the spread probabilities of a directed acyclic graph (DAG) that we define as the underlying mechanistic representation of the lymphatic network. An example of such a DAG is shown in <a href="#fig-small-graph" class="quarto-xref">figure 2</a>.</p>
<p>Using the introduced quantities, we can evolve the distribution of all possible hidden states from <span class="math inline">\(\mathbf{X}[t=0] = \boldsymbol{\xi}_0\)</span> step by step, by successively multiplying this vector with the transition matrix <span class="math inline">\(\mathbf{A}\)</span>. At the time of the diagnosis <span class="math inline">\(t_D\)</span>, we multiply the result with the observation matrix <span class="math inline">\(\mathbf{B}\)</span>. We may then look up the likelihood of a patient presenting with the diagnosis <span class="math inline">\(\mathbf{Z}=\boldsymbol{\zeta}_i\)</span> in the <span class="math inline">\(i\)</span>-th entry of the final result.</p>
<p>However, the remaining issue is that the value of <span class="math inline">\(t_D\)</span> is unknown, i.e. over how many time-steps the HMM should be evolved. We solve this problem by marginalizing over the time of diagnosis. Different distributions over the diagnosis times can then be choosen based on T-category. For instance, the mean of the time-prior to marginalize over the diagnosis time for early T-category patients <span class="math inline">\(P\left( t_D \mid \text{early} \right)\)</span> may be shifted towards earlier times than the one for advanced T-category patients <span class="math inline">\(P\left( t_D \mid \text{early} \right)\)</span>. This gives us for example</p>
<p><span class="math display">\[
P\left( \mathbf{X} \mid \text{T}x = \text{early} \right) = \sum_{t=0}^{t_\text{max}} P \left( \mathbf{X} \mid t \right) \cdot P(t \mid \text{early})
\]</span></p>
<p>For later use, we define at this point the matrices of the dsitributions over all hidden states, given all time-steps <span class="math inline">\(\boldsymbol{\Lambda}\)</span>:</p>
<p><span id="eq-lambda-matrix"><span class="math display">\[
\boldsymbol{\Lambda} = P \left( \mathbf{X} \mid \mathbf{t} \right) = \begin{pmatrix}
\boldsymbol{\pi}^\intercal \cdot \mathbf{A}^0 \\
\boldsymbol{\pi}^\intercal \cdot \mathbf{A}^1 \\
\vdots \\
\boldsymbol{\pi}^\intercal \cdot \mathbf{A}^{t_\text{max}} \\
\end{pmatrix}
\tag{4}\]</span></span></p>
<p>Where the <span class="math inline">\(k\)</span>-th row in this matrix corresponds to the distribution over hidden states after <span class="math inline">\(t=k-1\)</span> time-steps.</p>
<p>In this work, we use binomial distributions <span class="math inline">\(\mathfrak{B} \left( t_D, p_{\text{T}x} \right)\)</span> as time-priors which have one free parameter <span class="math inline">\(p_{\text{T}x}\)</span> for each group of patients we differentiate based on T-category. Also, we fix <span class="math inline">\(t_\text{max} = 10\)</span>, which means that the expected number of time-steps from the onset of a patient’s disease to their diagnosis is <span class="math inline">\(\mathbb{E}\left[ t_D \right] = 10 \cdot p_{\text{T}x}\)</span>.</p>
<section id="likelihood-function" class="level2">
<h2>Likelihood Function</h2>
<p>With the formalism introduced above, we can write the likelihood function for a patient to present with a diagnosis consisting of an observed state and a T-category <span class="math inline">\(d = \left( \boldsymbol{\zeta}_i, \text{T}x \right)\)</span> as follows:</p>
<p><span id="eq-single-patient-llh"><span class="math display">\[
\ell = P \left( \mathbf{Z} = \boldsymbol{\zeta}_i \mid \text{T}x \right) = \sum_{t=0}^{t_\text{max}} \left[ \boldsymbol{\xi}_0 \cdot \mathbf{A} \cdot \mathbf{B} \right]_i \cdot P \left( t \mid \text{T}x \right)
\tag{5}\]</span></span></p>
<p>Above, the quantity inside <span class="math inline">\(\left[ \ldots \right]_i\)</span> denotes the <span class="math inline">\(i\)</span>-th component of the vector that is the result of the vector and matrix multiplications in the square brackets. Note that it is also possible to account for missing involvement information: If a diagnosis (like fine needle aspiration (FNA)) is only available for a subset of all LNLs, we can sum over all those possible complete observed states <span class="math inline">\(\boldsymbol{\zeta}_j\)</span> that match the provided diagnosis.</p>
<p>The single-patient likelihood <span class="math inline">\(\ell\)</span> in <a href="#eq-single-patient-llh" class="quarto-xref">equation 5</a> depends on the spread parameters shown in <a href="#fig-small-graph" class="quarto-xref">figure 2</a> via the transition matrix <span class="math inline">\(\mathbf{A}\)</span> and on the binomial parameters <span class="math inline">\(p_{\text{T}x}\)</span> via time-priors. In this work, we will only differentiate between “early” (T1 &amp; T2) and “advanced” (T3 &amp; T4) T-categories. Therefore, the parameter space of the unilateral model is:</p>
<p><span id="eq-param-space"><span class="math display">\[
\boldsymbol{\theta} = \left( \left\{ b_v \right\}, \left\{ t_{vr} \right\}, p_\text{early}, p_\text{adv.} \right) \quad \text{with} \quad \genfrac{}{}{0pt}{2}{v\leq V}{r\in\operatorname{pa}(v)}
\tag{6}\]</span></span></p>
<p>And it is our goal to infer the values of these parameters for a given dataset <span class="math inline">\(\mathcal{D} = \left( d_1, d_2, \ldots, d_N \right)\)</span> of OPSCC patients. The likelihood of these <span class="math inline">\(N\)</span> diagnoses is simply the product of their individual likelihoods as defined in <a href="#eq-single-patient-llh" class="quarto-xref">equation 5</a>. For numerical reasons, we typically compute the data likelihood in log space:</p>
<p><span id="eq-log-likelihood"><span class="math display">\[
\log \mathcal{L} \left( \mathcal{D} \mid \boldsymbol{\theta} \right) = \sum_{i=1}^N \log \ell_i
\tag{7}\]</span></span></p>
<p>The methodology we use to infer the model’s parameters is detailed in <a href="#sec-sampling" class="quarto-xref">section 5.2</a>.</p>
</section>
<section id="model-prediction-in-the-bayesian-context" class="level2">
<h2>Model Prediction in the Bayesian Context</h2>
<p>Our stated goal is to compute the risk for a patient’s true nodal involvement state <span class="math inline">\(\mathbf{X}\)</span>, <em>given</em> their individual diagnosis <span class="math inline">\(d = \left( \boldsymbol{\zeta}_k, \text{T}x \right)\)</span>. Using Bayes’ law, this is written as:</p>
<p><span id="eq-uni-bayes-law"><span class="math display">\[
P \big( \mathbf{X} \mid \mathbf{Z}=\boldsymbol{\zeta}_k, \boldsymbol{\hat{\theta}}, \text{T}x \big) = \frac{P \left( \boldsymbol{\zeta}_k \mid \mathbf{X} \right) P \big( \mathbf{X} \mid \boldsymbol{\hat{\theta}}, \text{T}x \big)}{\sum_{i=0}^{2^V} P \left( \boldsymbol{\zeta}_k \mid \mathbf{X}=\boldsymbol{\xi}_i \right) P \big( \mathbf{X}=\boldsymbol{\xi}_i \mid \boldsymbol{\hat{\theta}}, \text{T}x \big)}
\tag{8}\]</span></span></p>
<p>The term <span class="math inline">\(P \left( \boldsymbol{\zeta}_k \mid \mathbf{X} \right)\)</span> is defined solely by sensitivity and specificity of the diagnostic modality. Terms like this already appeared in the definition of the observation matrx in <a href="#eq-obs-matrix" class="quarto-xref">equation 3</a>. The <em>prior</em> <span class="math inline">\(P \big( \mathbf{X} \mid \boldsymbol{\hat{\theta}} \big)\)</span> in the above equation is the crucial term that is supplied by a trained model and its parameters <span class="math inline">\(\boldsymbol{\hat{\theta}}\)</span>.</p>
<p>It is possible to compute this <em>posterior</em> probability of true involvement not only for one fully defined state <span class="math inline">\(\mathbf{X}\)</span>, but also for e.g. individual LNLs: For example, the risk for involvement in level IV would be a marginalization over all states <span class="math inline">\(\boldsymbol{\xi}_i\)</span>, where <span class="math inline">\(\xi_{i4}=1\)</span>. Formally:</p>
<p><span id="eq-marg-over-posterior"><span class="math display">\[
P \big( \text{IV} \mid \mathbf{Z}=\boldsymbol{\zeta}_k, \boldsymbol{\hat{\theta}}, \text{T}x  \big) = \sum_{k \, : \, \xi_{k4}=1} P \big( \mathbf{X} = \boldsymbol{\xi}_k \mid \boldsymbol{\zeta}_k, \boldsymbol{\hat{\theta}}, \text{T}x  \big)
\tag{9}\]</span></span></p>
</section>
</section>
<section id="sec-ext-to-contra" class="level1">
<h1>Extension to a Bilateral Model</h1>
<p>A naive approach to model the contralateral lymphatic spread would be to simply employ two independent unilateral models as introduced in <a href="#sec-unilateral" class="quarto-xref">section 3</a>. During training, one could even enforce some shared parameters between these two models, like the parameterization of the distributions over diagnose times or the spread among the LNLs. Additionally, we could think of an approach to incorporate the primary tumor’s mid-sagittal extension as a risk factor.</p>
<p>However, this approach lacks a way to describe the correlation between ipsi- and contralateral involvement. This is displayed in <a href="#tbl-data-strat" class="quarto-xref">table 3</a> and shows how often the contralateral LNLs I, II, III, and IV were involved, given all possible combinations of midline extension, T-category, and ipsilateral LNL III involvement. Unsurprisingly, the prevalence for contralateral involvement is consistently higher when the tumor extends over the mid-sagittal line or is of later T-category. But it is also more frequent when the ipsilateral side shows more severe involvement, which is here shown via the surrogate LNL III.</p>
<p>Thus, we attempt to extend the formalism in <a href="#sec-unilateral" class="quarto-xref">section 3</a> in such a way that the model’s ipsi- and contralateral side evolve synchronously. To achieve that, we start by writing down the posterior distribution of involvement an analogy to <a href="#eq-uni-bayes-law" class="quarto-xref">equation 8</a>, which is now a joint probability of an involvement <span class="math inline">\(\mathbf{X}^\text{i}\)</span> ipsilaterally <em>and</em> an involvement <span class="math inline">\(\mathbf{X}^\text{c}\)</span> contralaterally, given a diagnosis of the ipsilateral LNLs <span class="math inline">\(\mathbf{Z}^\text{i}\)</span> and of the contralateral ones <span class="math inline">\(\mathbf{Z}^\text{c}\)</span>:</p>
<p><span id="eq-bilateral-bayes"><span class="math display">\[
P \left( \mathbf{X}^\text{i}, \mathbf{X}^\text{c} \mid \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c} \right) = \frac{P \left( \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c} \mid \mathbf{X}^\text{i}, \mathbf{X}^\text{c} \right) P \left( \mathbf{X}^\text{i}, \mathbf{X}^\text{c} \right)}{P \left( \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c} \right)}
\tag{10}\]</span></span></p>
<p>For the sake of brevity, we omit the dependency on the parameters and the T-category here.</p>
<p>The likelihood of the diagnoses given a hidden state simply factorise: <span class="math inline">\(P \left( \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c} \mid \mathbf{X}^\text{i}, \mathbf{X}^\text{c} \right) = P \left( \mathbf{Z}^\text{i} \mid \mathbf{X}^\text{i} \right) \cdot P \left( \mathbf{Z}^\text{c} \mid \mathbf{X}^\text{c} \right)\)</span>. And the two factors are contained in the observation matrices <span class="math inline">\(\mathbf{B}^\text{i}\)</span> and <span class="math inline">\(\mathbf{B}^\text{c}\)</span>.</p>
<p>The term representing the model’s prior probability of hidden involvement does not factorize. However, if we assume that lymphatic spread typically does not cross the mid-sagittal line, we can write it as a factorising sum:</p>
<p><span id="eq-bilateral-marginal"><span class="math display">\[
\begin{aligned}
P \left( \mathbf{X}^\text{i}, \mathbf{X}^\text{c} \right) &amp;= \sum_{t=0}^{t_\text{max}} P(t) \cdot P \left( \mathbf{X}^\text{i}, \mathbf{X}^\text{c} \mid t \right) \\
&amp;= \sum_{t=0}^{t_\text{max}} P(t) \cdot P \left( \mathbf{X}^\text{i} \mid t \right) \cdot P \left( \mathbf{X}^\text{c} \mid t \right)
\end{aligned}
\tag{11}\]</span></span></p>
<p>This assumption makes intuitive sense: The two sides of the lymphatic network in a typical patient are approximately mirror images of each other. Thus, no major vessels cross the mid-sagittal line. There may, however, be diffusion of lymph fluid accross this line or bulky involvement that redirects lymphatic drainage significantly.</p>
<p>Using this assumption along with <a href="#eq-lambda-matrix" class="quarto-xref">equation 4</a>, we can write the above distribution algebraically as a product:</p>
<p><span id="eq-bilateral-marginal-algebra"><span class="math display">\[
P \left( \mathbf{X}^\text{i} = \boldsymbol{\xi}_n, \mathbf{X}^\text{c} = \boldsymbol{\xi}_m \right) = \left[ \boldsymbol{\Lambda}^\intercal_\text{i} \cdot \operatorname{diag} P(\mathbf{t}) \cdot \boldsymbol{\Lambda}_\text{c} \right]_{n,m}
\tag{12}\]</span></span></p>
<section id="sec-params-symmetry" class="level2">
<h2>Parameter Symmetries</h2>
<p>In general, the matrices <span class="math inline">\(\boldsymbol{\Lambda}_\text{i}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}_\text{c}\)</span> could be parameterized using a disjoint set of parameters. I.e., the ipsi- and contralateral spread rates are entirely different. However, using two sensible assumptions, we can reduce the parameter space by sharing some parameters between the sides:</p>
<ol type="1">
<li>We assume the spread <em>among</em> the LNLs to be same on both sides. It is reasonable to assume the lymphatic system is symmetric. Thus, the spread rates from one LNL to the other should be symmetric, too. Formally, this means<br />
<span id="eq-symmetries"><span class="math display">\[
\begin{aligned}
b_v^\text{c} &amp;\neq b_v^\text{i} \\
t_{rv}^\text{c} &amp;= t_{rv}^\text{i}
\end{aligned}
\tag{13}\]</span></span> for all <span class="math inline">\(v \leq V\)</span> and <span class="math inline">\(r \in \operatorname{pa}(v)\)</span>.</li>
<li>The tumor’s spread to the contralateral side in case of an extension over the midline is larger than if it was clearly lateralized, but smaller than its spread to the ipsilateral side. This assumption stems from a simple thought experiment: Consider moving the tumor from a clearly lateralized position accross the mid-sagittal plane to the same position, but on the contralateral side. In the beginning we would have <span class="math inline">\(b_v^\text{c} &lt; b_v^\text{i}\)</span>, while in the end, the situation is reversed. If a tumor extends over the mid-sagittal line, its contralateral spread rate can be expected to be in between these two extremes. We encode this in a <em>mixing parameter</em> <span class="math inline">\(\alpha\)</span> that captures a “degree of asymmetry”:<br />
<span id="eq-mixing"><span class="math display">\[
b_v^{\text{c},\epsilon=\texttt{True}} = \alpha \cdot b_v^\text{i} + (1 - \alpha) \cdot b_v^{\text{c},\epsilon=\texttt{False}}
\tag{14}\]</span></span> This means the model now uses three different sets of parameters to describe the spread from the tumor to the LNLs: <span class="math inline">\(b^\text{i}_v\)</span> for the spread to the ipsilateral LNLs, <span class="math inline">\(b_v^{\text{c},\epsilon=\texttt{False}}\)</span> for the spread to the contralateral LNLs as long as the tumor is clearly lateralized, and finally <span class="math inline">\(b_v^{\text{c},\epsilon=\texttt{True}}\)</span> when it crosses the midline. Note, however, that these three sets of spread rates only account for <span class="math inline">\(2 \cdot 2^V + 1\)</span> parameters, since they are coupled via the mixing parameter <span class="math inline">\(\alpha\)</span>.</li>
</ol>
<p>Our parameter space has now expanded to</p>
<p><span id="eq-bi-param-space"><span class="math display">\[
\boldsymbol{\theta} = \left( \left\{ b_v^\text{i} \right\}, \left\{ b_v^\text{c} \right\}, \alpha, \left\{ t_{vr} \right\}, p_\text{early}, p_\text{adv.} \right) \quad \text{with} \quad \genfrac{}{}{0pt}{2}{v\leq V}{r\in\operatorname{pa}(v)}
\tag{15}\]</span></span></p>
<p>which is less than double in size, compared to the unilateral model. From these parameters, we now build three different transition matrices: The unchanged <span class="math inline">\(\mathbf{A}_\text{i}\)</span> for the ipsilateral side, one <span class="math inline">\(\mathbf{A}_\text{c}^{\epsilon=\texttt{False}}\)</span> for the contralateral side that covers the progression as long as the tumor is lateralized, and <span class="math inline">\(\mathbf{A}_\text{c}^{\epsilon=\texttt{True}}\)</span> in case of a tumor that has crossed the mid-sagittal line.</p>
</section>
<section id="sec-midline" class="level2">
<h2>Modelling Midline Extension</h2>
<p>To account for the increased prevalence of involvement on the contralateral side when the tumor is not clearly lateralized anymore, we also model the tumor’s extension over the mid-sagittal line as a binary random variable. It starts lateralized and at every time-step there is a finite probability <span class="math inline">\(p_\epsilon\)</span> that the tumor grows over the symmetry plane of the patient.</p>
<p>The overall probabilities to find a patient with a clearly lateralized tumor or one that extends over the mid-sagittal line after <span class="math inline">\(t\)</span> time-steps are then respectively given by</p>
<p><span class="math display">\[
\begin{aligned}
P(\epsilon = \texttt{False} \mid t) &amp;= (1 - p_\epsilon)^t \\
P(\epsilon = \texttt{True} \mid t) &amp;= 1 - P(\epsilon = \texttt{False} \mid t)
\end{aligned}
\]</span></p>
<p>In <a href="#fig-model-midext-evo" class="quarto-xref">figure 3</a>, we visualize how the prior distribution over diagnose times <span class="math inline">\(P(t)\)</span>, the conditional probability of midline extension <span class="math inline">\(P(\epsilon \mid t)\)</span>, and their joint <span class="math inline">\(P(\epsilon, t)\)</span> evolve over the course of a patient evolution.</p>
<div id="fig-model-midext-evo" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-midext-evo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-model-midext-evo.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure 3: The top panel shows the prior probability to get diagnosed at time-step t for early and late T-category tumors as bars. Also in the top panel, we plot the conditional probability of the tumor’s midline extension (\epsilon=\texttt{True}), given the time-step t as a line plot. In the bottom panel, we show the joint probability of getting diagnosed in time-step t and having a tumor that crosses the midline."><img src="figures/fig-model-midext-evo.svg" class="img-fluid" style="width:50.0%" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-midext-evo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3: The top panel shows the prior probability to get diagnosed at time-step <span class="math inline">\(t\)</span> for early and late T-category tumors as bars. Also in the top panel, we plot the conditional probability of the tumor’s midline extension (<span class="math inline">\(\epsilon=\texttt{True}\)</span>), given the time-step <span class="math inline">\(t\)</span> as a line plot. In the bottom panel, we show the joint probability of getting diagnosed in time-step <span class="math inline">\(t\)</span> <em>and</em> having a tumor that crosses the midline.
</figcaption>
</figure>
</div>
<p>Using this, it is straightforward to write down the matrix of state distributions for all time-steps, as in <a href="#eq-lambda-matrix" class="quarto-xref">equation 4</a> covering the contralateral hidden state evolution:</p>
<p><span class="math display">\[
\boldsymbol{\Lambda}_\text{c}^{\epsilon=\texttt{False}} =
\left(
\begin{array}{r}
\boldsymbol{\pi}^\intercal \cdot \left( \mathbf{A}_\text{c}^{\epsilon=\texttt{False}} \right)^{0\phantom{t_\text{max}}} \\
(1-p_\epsilon) \cdot \boldsymbol{\pi}^\intercal \cdot \left( \mathbf{A}_\text{c}^{\epsilon=\texttt{False}} \right)^{1\phantom{t_\text{max}}} \\
\hfill \vdots \hfill \\
(1-p_\epsilon)^{t_\text{max}} \cdot \boldsymbol{\pi}^\intercal \cdot \left( \mathbf{A}_\text{c}^{\epsilon=\texttt{False}} \right)^{t_\text{max}\phantom{0}} \\
\end{array}
\right)
\]</span></p>
<p>where we used the transition matrix <span class="math inline">\(\mathbf{A}_\text{c}^{\epsilon=\texttt{False}}\)</span> that depends on the base spread parameters <span class="math inline">\(b_v^{\text{c},\epsilon=\texttt{False}}\)</span>.</p>
<p>The case when midline extension is eventually present is more complicated: We already marginalize over the exact time-step when the tumor grows over the mid-sagittal line. But whenever that happens, we also need to change the contralateral transition matrix to use the increased spread rates <span class="math inline">\(b_v^{\text{c}, \epsilon=\texttt{True}}\)</span> from the tumor to the contralateral LNLs, given by the linear mix in <a href="#eq-mixing" class="quarto-xref">equation 14</a>. We can achieve the correct marginalization by iteratively building the joint <span class="math inline">\(P \left( \mathbf{X}^\text{c}, \epsilon=\texttt{True} \mid t \right)\)</span>. We start from <span class="math inline">\(t=0\)</span>, where we know that all LNLs are healthy - i.e., the contralateral neck is in the state <span class="math inline">\(\mathbf{X}_\text{c}=\boldsymbol{\xi}_0\)</span> - and the tumor is lateralized (<span class="math inline">\(\epsilon=\texttt{False}\)</span>):</p>
<p><span class="math display">\[
P \left( \mathbf{X}^\text{c}, \epsilon=\texttt{False} \mid t=0 \right) = \boldsymbol{\xi}_0
\]</span></p>
<p>Then we consider an arbitrary later time-step <span class="math inline">\(t=\tau+1\)</span>. There are two possible scenarios we need to marginalize over:</p>
<ol type="1">
<li>The tumor was still lateralized at <span class="math inline">\(t=\tau\)</span> and just grew over the midline. Under this scenario, the probability for having a midline extension at <span class="math inline">\(t=\tau+1\)</span> is given by <span class="math inline">\(p_\epsilon\)</span>. We use this to weight the contralateral state distribution that was so far evolved without increased contralateral spread.</li>
<li>The mid-sagittal line was already crossed by the tumor. In that case, the probability is 1 to remain in that lateralization state. Thus, for this case we simply add the same distribution we are computing, but from one time-step earlier, arriving at a recursion relation:</li>
</ol>
<p><span class="math display">\[
P \left( \mathbf{X}^\text{c}, \epsilon=\texttt{True} \mid \tau + 1 \right) = \big[ p_\epsilon P \left( \mathbf{X}^\text{c}, \epsilon=\texttt{False} \mid \tau \right) + P \left( \mathbf{X}^\text{c}, \epsilon=\texttt{True} \mid \tau \right) \big]^\top \cdot \mathbf{A}_\text{c}^{\epsilon=\texttt{True}}
\]</span></p>
<p>We can collect the iteratively computed distributions for the midline extension case to define the matrix over the states given all time-steps, in analogy to <a href="#eq-lambda-matrix" class="quarto-xref">equation 4</a>:</p>
<p><span class="math display">\[
\boldsymbol{\Lambda}_\text{c}^{\epsilon=\texttt{True}} = \begin{pmatrix}
P \left( \mathbf{X}^\text{c}, \epsilon=\texttt{True} \mid 0 \right) \\
P \left( \mathbf{X}^\text{c}, \epsilon=\texttt{True} \mid 1 \right) \\
\vdots \\
P \left( \mathbf{X}^\text{c}, \epsilon=\texttt{True} \mid t_\text{max} \right) \\
\end{pmatrix}
\]</span></p>
<p>Using this, we can again write the joint of ipsi- and contralateral involvement - now also for the case of mid-sagittal extension - algebraically as before in <a href="#eq-bilateral-marginal-algebra" class="quarto-xref">equation 12</a>:</p>
<p><span class="math display">\[
P \left( \mathbf{X}^\text{i} = \boldsymbol{\xi}_n, \mathbf{X}^\text{c} = \boldsymbol{\xi}_m, \epsilon \right) = \left[ \boldsymbol{\Lambda}^\intercal_\text{i} \cdot \operatorname{diag} P(\mathbf{t}) \cdot \boldsymbol{\Lambda}_\text{c}^\epsilon \right]_{n,m}
\]</span></p>
<p>We can use this term to compute the likelihood of all patients with and without midline extension separately. And if for some patients the information of tumor lateralization is not available, we can simply sum the above term once for <span class="math inline">\(\epsilon=\texttt{False}\)</span> and once for <span class="math inline">\(\epsilon=\texttt{True}\)</span> to marginalize over the unknown variable.</p>
<p>The final parameter space of our extended model has now reached this size:</p>
<p><span id="eq-ext-param-space"><span class="math display">\[
\boldsymbol{\theta} = \left( \left\{ b_v^\text{i} \right\}, \left\{ b_v^\text{c} \right\}, \alpha, \left\{ t_{vr} \right\}, p_\text{early}, p_\text{adv.}, p_\epsilon \right) \quad \text{with} \quad \genfrac{}{}{0pt}{2}{v\leq V}{r\in\operatorname{pa}(v)}
\tag{16}\]</span></span></p>
<p>In <a href="#fig-model-state-dist" class="quarto-xref">figure 4</a> we plot the state distribution for a full midline model as two separate heatmaps. To keep it manageable to interpret, this example model only considers the LNLs II, III, and IV ipsi- and contralaterally, resulting in <span class="math inline">\(2 \times 2^3 \times 2^3 = 128\)</span> distinct states.</p>
<div id="fig-model-state-dist" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-state-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-model-state-dist.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure 4: 3D state distribution of a midline model with 3 LNLs (II, III, and IV) in both sides of the neck. Note the higher probability for contralateral involvement in the right subplot, where the tumor extends over the mid-sagittal line."><img src="figures/fig-model-state-dist.svg" class="img-fluid" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-state-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 4: 3D state distribution of a midline model with 3 LNLs (II, III, and IV) in both sides of the neck. Note the higher probability for contralateral involvement in the right subplot, where the tumor extends over the mid-sagittal line.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="sec-methods" class="level1">
<h1>Methods</h1>
<!-- Maybe I should break this apart into separate chapters on data, sampling, etc. -->
<p>In this section, we detail how the experiments were performed. Every figure, table, and result is fully reproducible via the GitHub repository <a href="https://github.com/rmnldwg/bilateral-paper"><code>rmnldwg/bilateral-paper</code></a>. It also contains the raw manuscript and instructions on how to recreate all figures, tables, and the final document.</p>
<section id="involvement-data-consensus" class="level2">
<h2>Involvement Data Consensus</h2>
<p>It is possible to provide our model with multiple different diagnostic modalities, each being characterized by different pairs of sensitivity and specificity. However, we instead chose to combine them into a single “consensus” diagnosis before parameter inference. We opted for this because the literature values of sensitivity and specificity <span class="citation" data-cites="de_bondt_detection_2007 kyzas_18f-fluorodeoxyglucose_2008">(<a href="#ref-de_bondt_detection_2007" role="doc-biblioref">De Bondt and Others 2007</a>; <a href="#ref-kyzas_18f-fluorodeoxyglucose_2008" role="doc-biblioref">Kyzas and Others 2008</a>)</span> of imaging modalities like MRI and CT do not plausibly match some of our observations: In the USZ cohort, 78% of OPSCC patients where diagnosed with ipsilateral LNL II involvement via diagnostic imaging. This is virtually impossible with sensitivities around 80% and specificities lower than 100%.</p>
<p>Our pre-training consensus was formed by considering all reported diagnostic information for a particular patient and LNL. When conflicts arose, we computed the <em>most likely</em> true state of involvement using the literature sensitivity and specificity values <span class="citation" data-cites="de_bondt_detection_2007 kyzas_18f-fluorodeoxyglucose_2008">(<a href="#ref-de_bondt_detection_2007" role="doc-biblioref">De Bondt and Others 2007</a>; <a href="#ref-kyzas_18f-fluorodeoxyglucose_2008" role="doc-biblioref">Kyzas and Others 2008</a>)</span>.</p>
</section>
<section id="sec-sampling" class="level2">
<h2>MCMC Sampling</h2>
<p>For parameter inference, we used the Python package <a href="https://emcee.readthedocs.io/en/stable/"><code>emcee</code></a> <span class="citation" data-cites="foreman-mackey_emcee_2013">(<a href="#ref-foreman-mackey_emcee_2013" role="doc-biblioref">Foreman-Mackey et al. 2013</a>)</span>. It implements efficient MCMC sampling algorithms that employ multiple parallel samplers for affine invariance and better performance on multi-core CPUs. The sample proposal algirothms used by us are based on differential evolution moves <span class="citation" data-cites="ter_braak_differential_2008 nelson_run_2013">(<a href="#ref-ter_braak_differential_2008" role="doc-biblioref">ter Braak and Vrugt 2008</a>; <a href="#ref-nelson_run_2013" role="doc-biblioref">Nelson, Ford, and Payne 2013</a>)</span>. The <a href="https://emcee.readthedocs.io/en/stable/"><code>emcee</code></a> library was provided with the likelihood implemented by our <a href="https://lymph-model.readthedocs.io/en/stable/"><code>lymph-model</code></a> Python package.</p>
<p>For each dimension in the parameter space of the model, we initialized 12 of these parallel samplers, called “walkers”, with random values in the unit cube. Every time all of these walkers advanced 50 steps, the autocorrelation time of the chains was estimated. For short chains, this estimate is not trustworthy, but stabilizes for longer chains. We therefore considered a sampling to be converged when two criteria where met:</p>
<ol type="1">
<li>The change in the autocorrelation time was less then 5.0e-2.</li>
<li>The estimate of the autocorrelation dropped below <span class="math inline">\(n\)</span> / 50 where <span class="math inline">\(n\)</span> is the length of the chain up to that point.</li>
</ol>
<p>All samples up to this convergence - called the <em>burn-in phase</em> - were discarded. We only kept another 10 samples after that, which were spaced 10 steps apart.</p>
</section>
<section id="sec-prevalence" class="level2">
<h2>Computing the Observed and Predicted Prevalence of Involvement Patterns</h2>
<p>We want to assess the model’s capability to approximate the distribution of lymphatic involvement patterns seen in the data. To that end, we compare the prevalence of some invovlement patterns under selected scenarios with the model’s prediction for how often these involvements it expects to see, given these scenarios.</p>
<p>In this context, a “scenario” includes the patient’s T-category <span class="math inline">\(\text{T}x\)</span> and whether the patient’s tumor extended over the mid-sagittal line, i.e. <span class="math inline">\(\epsilon=\texttt{True}\)</span> or <span class="math inline">\(\epsilon=\texttt{False}\)</span>.</p>
<p>An involvement pattern specifies for each ipsi- and contralateral LNL whether it is “healthy”, “involved”, or “masked”. If it is “masked”, we essentially state that we are not interested in the involvement of that LNL and the prevalence will be marginalized over this LNL’s involvement.</p>
<p>For example, we may be interested in the prevalence of contralateral LNL II involvement (i.e., contra LNL II “involved” and all other LNLs “masked”) under the scenario of early T-category (T0-T2) and no midline extension (<span class="math inline">\(\epsilon=\texttt{False}\)</span>). To compute this prevalence in the data, we select all patients of this scenario (in our data, this amounts to 379<!-- TODO: dyamically compute this --> patients). Of those, 28<!-- TODO: dynamically compute this --> were found to harbor metastases in their contralateral LNL II. Therefore, the prevalence is 7%<!-- TODO: dynamically compute this -->.</p>
<p>When displaying this data prevalence, we often choose to draw a <em>beta posterior</em> over the “true” prevalence, hinting at the fact that our data merely represents a limited sample. The beta posterior follows from a uniform beta distribution as prior and a binomial likelihood for the number of patients with the involvement of interest, given the parameer for the “true” prevalence. The resulting distribution has its maximum at the observed prevalence, but in addition gives a visual intuition for the variance of of the observed quantity. I.e., when we observe 3 out of 10 events, the beta posterior is much wider than if we observe 300 out of 1000 for he same prevalence. It also allows us to check not only if the model is accurate, but also whether it reflects the uncertainty contained in the data.</p>
<p>Predicting the prevalence using our model amounts to computing the following probability:</p>
<p><span class="math display">\[
P \left( \text{II}^\text{c} \mid \epsilon=\texttt{False}, \text{T}x=\text{early} \right) = \frac{P \left( \text{II}^\text{c}, \epsilon=\texttt{False} \mid \text{T}x=\text{early} \right)}{P \left( \epsilon=\texttt{False} \mid \text{T}x=\text{early} \right)}
\]</span></p>
<p>In the enumator, we marginalize over all ipsi- and contralateral LNLs’ involvements, except for LNL II contralaterally. This is similar to the marginalization in <a href="#eq-marg-over-posterior" class="quarto-xref">equation 9</a>, although we are summing over different quantities. In the denominator, we can simply insert the joint distribution over midline extension and diagnose time <span class="math inline">\(P \left( \epsilon, t \right)\)</span> marginalized over <span class="math inline">\(t\)</span> using the early T-category’s time-prior.</p>
<p>Since we compare it to the data, which does not report true but only observed involvement – although pathologically investigated LNLs may be as close as possible to the ground truth – we do not consider posteriors of the form <span class="math inline">\(P \left( \mathbf{X} \mid \mathbf{Z} \right)\)</span> here. Instead, we compute probabilities of observed involvement <span class="math inline">\(P \left( \mathbf{Z} \right)\)</span>, as in the likelihood <a href="#eq-single-patient-llh" class="quarto-xref">equation 5</a>.</p>
<p>When plotted, we usually display histograms over the model’s predictions. Each of their values was computed from a different parameter set drawn during MCMC sampling, effectively giving us a distribution over the prevalences. Ideally, the histograms approximate the location and width of the Beta posteriors when attempting to describe the data they were trained on.</p>
<p>Note that we decided to omit the y-axis ticks and labels in these figures over prevalences and risks. The y-axis in these plots measures the probability density and its numerical values are not intuitively interpretable. Instead, we occasionally use the freed space to label e.g. rows of subplots.</p>
</section>
</section>
<section id="sec-results" class="level1">
<h1>Results</h1>
<p>First, in <a href="#fig-model-burnin-history" class="quarto-xref">figure 5</a>, we verify the sampling converged successfully by inspecting two monitoring quantities: The autocorrelation time of the MCMC chain and the acceptance fractions of the parallel walkers.</p>
<div id="fig-model-burnin-history" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-burnin-history-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-model-burnin-history.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure 5: Monitoring quantities during the burn-in phase of the parameter sampling. Left: The autocorrelation time of the sampling chain estimated at different sampling steps. We consider the chain converged when the estimate of the autocorrelation time is stable and drops below the trust threshold of n/50 where n is the number of steps. Right: Fraction of accepted MCMC proposals averaged over all parallel walkers. Values around 30% indicate good mixing of the walkers."><img src="figures/fig-model-burnin-history.svg" class="img-fluid" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-burnin-history-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 5: Monitoring quantities during the burn-in phase of the parameter sampling. Left: The autocorrelation time of the sampling chain estimated at different sampling steps. We consider the chain converged when the estimate of the autocorrelation time is stable and drops below the trust threshold of <span class="math inline">\(n/50\)</span> where <span class="math inline">\(n\)</span> is the number of steps. Right: Fraction of accepted MCMC proposals averaged over all parallel walkers. Values around 30% indicate good mixing of the walkers.
</figcaption>
</figure>
</div>
<p>In <a href="#tbl-midline-params" class="quarto-xref">table 2</a>, we tabulate the mean and standard deviation of the sampled parameters for the full midline model.</p>
</section>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_param_names(name: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;Make parameter names more readable.&quot;&quot;&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;midext_prob&quot;</span>: <span class="st">&quot;Mid. ext. probability&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;mixing&quot;</span>: <span class="st">&quot;Mixing ⍺&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;late_p&quot;</span>: <span class="st">&quot;late T-cat. binom. prob.&quot;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    }[name]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> re.sub(</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="vs">r&quot;(ipsi|contra)_&quot;</span>, <span class="vs">r&quot;\g&lt;1&gt;: &quot;</span>, name</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    ).replace(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;to&quot;</span>, <span class="st">&quot; ➜ &quot;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    ).replace(</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;_spread&quot;</span>, <span class="st">&quot;&quot;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> shared.get_model(which<span class="op">=</span><span class="st">&quot;full&quot;</span>, load_samples<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> shared.get_samples(which<span class="op">=</span><span class="st">&quot;full&quot;</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> [map_param_names(p) <span class="cf">for</span> p <span class="kw">in</span> model.get_params()]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>means, stds <span class="op">=</span> samples.mean(axis<span class="op">=</span><span class="dv">0</span>), samples.std(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>early_midext_prob <span class="op">=</span> model.state_dist(t_stage<span class="op">=</span><span class="st">&quot;early&quot;</span>)[<span class="dv">1</span>].<span class="bu">sum</span>()</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>late_midext_prob <span class="op">=</span> model.state_dist(t_stage<span class="op">=</span><span class="st">&quot;late&quot;</span>)[<span class="dv">1</span>].<span class="bu">sum</span>()</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>params_table <span class="op">=</span> pd.DataFrame({<span class="st">&quot;Parameter&quot;</span>: names, <span class="st">&quot;Mean&quot;</span>: means, <span class="st">&quot;Std. Dev.&quot;</span>: stds})</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  params_table.style</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">format</span>(<span class="st">&quot;</span><span class="sc">{:.2%}</span><span class="st">&quot;</span>, subset<span class="op">=</span>[<span class="st">&quot;Mean&quot;</span>])</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">format</span>(<span class="st">&quot;± </span><span class="sc">{:.2%}</span><span class="st">&quot;</span>, subset<span class="op">=</span>[<span class="st">&quot;Std. Dev.&quot;</span>])</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">apply</span>(right_align, subset<span class="op">=</span>[<span class="st">&quot;Mean&quot;</span>, <span class="st">&quot;Std. Dev.&quot;</span>])</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  .hide()</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="tbl-midline-params" class="cell quarto-float quarto-figure quarto-figure-center" data-execution_count="5">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-midline-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 2: Mean sampled parameter estimates of the midline model and the respective standard deviation.
</figcaption>
<div aria-describedby="tbl-midline-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="4">
<style type="text/css">
#T_aea80_row0_col1, #T_aea80_row0_col2, #T_aea80_row1_col1, #T_aea80_row1_col2, #T_aea80_row2_col1, #T_aea80_row2_col2, #T_aea80_row3_col1, #T_aea80_row3_col2, #T_aea80_row4_col1, #T_aea80_row4_col2, #T_aea80_row5_col1, #T_aea80_row5_col2, #T_aea80_row6_col1, #T_aea80_row6_col2, #T_aea80_row7_col1, #T_aea80_row7_col2, #T_aea80_row8_col1, #T_aea80_row8_col2, #T_aea80_row9_col1, #T_aea80_row9_col2, #T_aea80_row10_col1, #T_aea80_row10_col2, #T_aea80_row11_col1, #T_aea80_row11_col2, #T_aea80_row12_col1, #T_aea80_row12_col2, #T_aea80_row13_col1, #T_aea80_row13_col2, #T_aea80_row14_col1, #T_aea80_row14_col2, #T_aea80_row15_col1, #T_aea80_row15_col2, #T_aea80_row16_col1, #T_aea80_row16_col2, #T_aea80_row17_col1, #T_aea80_row17_col2, #T_aea80_row18_col1, #T_aea80_row18_col2 {
  text-align: right;
}
</style>

<table id="T_aea80" class="do-not-create-environment cell" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_aea80_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Parameter</th>
<th id="T_aea80_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Mean</th>
<th id="T_aea80_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Std. Dev.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_aea80_row0_col0" class="data row0 col0">Mid. ext. probability</td>
<td id="T_aea80_row0_col1" class="data row0 col1">8.16%</td>
<td id="T_aea80_row0_col2" class="data row0 col2">± 0.48%</td>
</tr>
<tr class="even">
<td id="T_aea80_row1_col0" class="data row1 col0">ipsi: T ➜ I</td>
<td id="T_aea80_row1_col1" class="data row1 col1">2.80%</td>
<td id="T_aea80_row1_col2" class="data row1 col2">± 0.26%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row2_col0" class="data row2 col0">ipsi: T ➜ II</td>
<td id="T_aea80_row2_col1" class="data row2 col1">34.89%</td>
<td id="T_aea80_row2_col2" class="data row2 col2">± 1.40%</td>
</tr>
<tr class="even">
<td id="T_aea80_row3_col0" class="data row3 col0">ipsi: T ➜ III</td>
<td id="T_aea80_row3_col1" class="data row3 col1">5.45%</td>
<td id="T_aea80_row3_col2" class="data row3 col2">± 0.66%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row4_col0" class="data row4 col0">ipsi: T ➜ IV</td>
<td id="T_aea80_row4_col1" class="data row4 col1">0.94%</td>
<td id="T_aea80_row4_col2" class="data row4 col2">± 0.18%</td>
</tr>
<tr class="even">
<td id="T_aea80_row5_col0" class="data row5 col0">ipsi: T ➜ V</td>
<td id="T_aea80_row5_col1" class="data row5 col1">1.83%</td>
<td id="T_aea80_row5_col2" class="data row5 col2">± 0.22%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row6_col0" class="data row6 col0">ipsi: T ➜ VII</td>
<td id="T_aea80_row6_col1" class="data row6 col1">2.32%</td>
<td id="T_aea80_row6_col2" class="data row6 col2">± 0.26%</td>
</tr>
<tr class="even">
<td id="T_aea80_row7_col0" class="data row7 col0">contra: T ➜ I</td>
<td id="T_aea80_row7_col1" class="data row7 col1">0.29%</td>
<td id="T_aea80_row7_col2" class="data row7 col2">± 0.09%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row8_col0" class="data row8 col0">contra: T ➜ II</td>
<td id="T_aea80_row8_col1" class="data row8 col1">2.46%</td>
<td id="T_aea80_row8_col2" class="data row8 col2">± 0.29%</td>
</tr>
<tr class="even">
<td id="T_aea80_row9_col0" class="data row9 col0">contra: T ➜ III</td>
<td id="T_aea80_row9_col1" class="data row9 col1">0.14%</td>
<td id="T_aea80_row9_col2" class="data row9 col2">± 0.07%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row10_col0" class="data row10 col0">contra: T ➜ IV</td>
<td id="T_aea80_row10_col1" class="data row10 col1">0.19%</td>
<td id="T_aea80_row10_col2" class="data row10 col2">± 0.08%</td>
</tr>
<tr class="even">
<td id="T_aea80_row11_col0" class="data row11 col0">contra: T ➜ V</td>
<td id="T_aea80_row11_col1" class="data row11 col1">0.05%</td>
<td id="T_aea80_row11_col2" class="data row11 col2">± 0.04%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row12_col0" class="data row12 col0">contra: T ➜ VII</td>
<td id="T_aea80_row12_col1" class="data row12 col1">0.50%</td>
<td id="T_aea80_row12_col2" class="data row12 col2">± 0.17%</td>
</tr>
<tr class="even">
<td id="T_aea80_row13_col0" class="data row13 col0">Mixing ⍺</td>
<td id="T_aea80_row13_col1" class="data row13 col1">33.87%</td>
<td id="T_aea80_row13_col2" class="data row13 col2">± 4.32%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row14_col0" class="data row14 col0">I ➜ II</td>
<td id="T_aea80_row14_col1" class="data row14 col1">62.50%</td>
<td id="T_aea80_row14_col2" class="data row14 col2">± 16.69%</td>
</tr>
<tr class="even">
<td id="T_aea80_row15_col0" class="data row15 col0">II ➜ III</td>
<td id="T_aea80_row15_col1" class="data row15 col1">14.23%</td>
<td id="T_aea80_row15_col2" class="data row15 col2">± 1.64%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row16_col0" class="data row16 col0">III ➜ IV</td>
<td id="T_aea80_row16_col1" class="data row16 col1">15.86%</td>
<td id="T_aea80_row16_col2" class="data row16 col2">± 1.93%</td>
</tr>
<tr class="even">
<td id="T_aea80_row17_col0" class="data row17 col0">IV ➜ V</td>
<td id="T_aea80_row17_col1" class="data row17 col1">14.58%</td>
<td id="T_aea80_row17_col2" class="data row17 col2">± 3.76%</td>
</tr>
<tr class="odd">
<td id="T_aea80_row18_col0" class="data row18 col0">late T-cat. binom. prob.</td>
<td id="T_aea80_row18_col1" class="data row18 col1">44.98%</td>
<td id="T_aea80_row18_col2" class="data row18 col2">± 1.99%</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div id="12255449" class="cell markdown">
<section id="prevalence-predictions" class="level2">
<h2>Prevalence Predictions</h2>
<p>We want to investigate whether and to what extent the model can fulfill the requirements laid out in <a href="#sec-requirements" class="quarto-xref">section 2.2</a>. To that end, we compare its predictions for contralateral involvement against observations in the data. This is done given scenarios that differ in T-category and/or midline extension and/or ipsilateral involvement.</p>
<section id="dependence-of-contralateral-involvement-on-t-category-and-midline-extension" class="level3">
<h3>Dependence of Contralateral Involvement on T-Category and Midline Extension</h3>
<p>In <a href="#fig-model-prevalences-overall" class="quarto-xref">figure 6</a>, we plot the prevalence of contralateral involvement of the LNLs II, III, and IV for the four scenarios made up of the possible combinations of early and late T-category, as well as lateralized and midline extending tumors.</p>
<div id="fig-model-prevalences-overall" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-prevalences-overall-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-model-prevalences-overall.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure 6: Comparison of predicted (histograms) vs observed (beta posteriors) prevalences. Shown for the contralateral LNLs II (blue), III (orange), and IV (green). The top row shows scenarios with early T-category tumors, the bottom row for late T-category ones. The left column depicts scenarios where the primary tumor is clearly lateralized, the right column scenarios of tumors extending over the mid-sagittal line. This figure illustrates the model’s ability to describe the prevalence of different combinations of scenarios involving the risk factors T-category and midline extension."><img src="figures/fig-model-prevalences-overall.svg" class="img-fluid" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-prevalences-overall-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 6: Comparison of predicted (histograms) vs observed (beta posteriors) prevalences. Shown for the contralateral LNLs II (blue), III (orange), and IV (green). The top row shows scenarios with early T-category tumors, the bottom row for late T-category ones. The left column depicts scenarios where the primary tumor is clearly lateralized, the right column scenarios of tumors extending over the mid-sagittal line. This figure illustrates the model’s ability to describe the prevalence of different combinations of scenarios involving the risk factors T-category and midline extension.
</figcaption>
</figure>
</div>
<p><a href="#fig-model-prevalences-overall" class="quarto-xref">Figure 6</a> shows nicely how the model is capable of accurately taking the most important risk factors, i.e. T-category and midline extension, into account. As observed in the data, the model predicts that the prevalence of contralateral LNL II involvement jumps from below 8% <!-- TODO: make this dynamic --> for early T-category lateralized tumors to almost 40% <!-- TODO: make this dynamic --> when the tumor is of advanced T-category and crosses the mid-sagittal line.</p>
<p>However, for early T-category scenarios with midline extension, the model does seem to overestimate contralateral LNL II and III invovlement. This likely stems from the the small sample size of this relatively rare scenario as hinted at by the wide beta posteriors.</p>
</section>
<section id="correlation-between-ipsi--and-contralateral-involvement" class="level3">
<h3>Correlation between Ipsi- and Contralateral Involvement</h3>
<div id="fig-model-prevalences-with-ipsi" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-prevalences-with-ipsi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-model-prevalences-with-ipsi.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure 7: Comparison of the computed and observed prevalences for scenarios that illustrate the model’s capability of accounting for the correlation between ipsi- and contralateral involvement. We show two scenarios: One where the ipsilateral neck shows no involvement (at least LNLs I to V are healthy, LNL VII was ignored because data on it is missing for some patients) in blue and one where at least LNL III was involved in orange. These two scenarios are plotted for all combinations of T-category (early in top row, advanced in bottom row) and tumor lateralization (lateralized in left column, extending over mid-sagittal line in right column)."><img src="figures/fig-model-prevalences-with-ipsi.svg" class="img-fluid" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-prevalences-with-ipsi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 7: Comparison of the computed and observed prevalences for scenarios that illustrate the model’s capability of accounting for the correlation between ipsi- and contralateral involvement. We show two scenarios: One where the ipsilateral neck shows no involvement (at least LNLs I to V are healthy, LNL VII was ignored because data on it is missing for some patients) in blue and one where at least LNL III was involved in orange. These two scenarios are plotted for all combinations of T-category (early in top row, advanced in bottom row) and tumor lateralization (lateralized in left column, extending over mid-sagittal line in right column).
</figcaption>
</figure>
</div>
<p>In <a href="#fig-model-prevalences-with-ipsi" class="quarto-xref">figure 7</a> we display the model’s ability to capture the correlation between ipsi- and contralateral involvement. It shows that the prevalence of metastases in the two sides of the neck is correlated via the time of diagnosis, despite the model not having any direct connections between the two side. However, there are some discrepancies in the model’s prediction: It cannot quite capture the correlation of ipsi- and contralateral involvement that is seen in the data. This is notable for example in the bottom right subplot where the prevalence is overestimated for the scenario of an (almost) healthy ipsilateral neck and underestimated when at least LNL III shows metastases. One reason for this may be the width of the time-prior: If it was wider, the posterior over the diagnosis time given the ipsilateral involvement could more flexibly shift to reflect a more severe contralateral involvement.</p>
<!-- NOTE: This last sentence is purely speculative! We need to discuss this. -->
</section>
<section id="prevalence-of-midline-extension" class="level3">
<h3>Prevalence of Midline Extension</h3>
<div id="fig-model-prevalences-midext" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-prevalences-midext-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-model-prevalences-midext.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure 8: Comparing the predicted (histograms) and observed (lines depicting beta posteriors) prevalence of midline extension for early (blue) and late (orange) T-category. While the prevalence is predicted correctly when marginalizing over T-category, the model cannot capture the degree of separation observed in the data. Since the tumor’s midline extension is virtually always part of the diagnosis and hence given when predicting a patient’s risk, we do not consider this discrepancy a major issue."><img src="figures/fig-model-prevalences-midext.svg" class="img-fluid" style="width:50.0%" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-prevalences-midext-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 8: Comparing the predicted (histograms) and observed (lines depicting beta posteriors) prevalence of midline extension for early (blue) and late (orange) T-category. While the prevalence is predicted correctly when marginalizing over T-category, the model cannot capture the degree of separation observed in the data. Since the tumor’s midline extension is virtually always part of the diagnosis and hence <em>given</em> when predicting a patient’s risk, we do not consider this discrepancy a major issue.
</figcaption>
</figure>
</div>
<p>Lastly, in <a href="#fig-model-prevalences-midext" class="quarto-xref">figure 8</a>, we plot the prevalence of midline extension in the data versus our model’s prediction. It is obvious the model cannot match the large spread between early and advanced T-category seen in the data. This is because to achieve that, it would need to increase the advanced T-category patient’s prior distribution over diagnosis times and at the same time reduce the probability of the tumor to cross the midline during a time-step. But since the time-priors parameter is also coupled with the spread probabilities among the LNLs, the model does not have that freedom.</p>
<!-- Should the paragraphs below be part of the discussion? -->
<p>However, we do not consider this discrepancy a major limitation of the model: We will not realistically be interested in the probability of midline extension, as it is always possible to assess it with high certainty. That is also the reason why we initially modelled the midline extension <em>not</em> as a random variable, but as a global risk factor that would have been turned on or off from the onset of a patient’s disease evolution. This, however, lead to overly high risks for contralateral involvement in advanced T-category patients with midline extension, because then the model assumes an increased spread to the contralateral side from the onset of the disease. Which is probably not true in a majority of those cases. Thus, treating it as a random variable that only becomes true during a patient’s disease evolution resulted in a better description of the data.</p>
<p>Formally, the wrong prediction of midline extension prevalence makes little difference, since it is always given: Instead of <span class="math inline">\(P\left( \mathbf{X}^\text{i}, \mathbf{X}^\text{c}, \epsilon \mid \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c} \right)\)</span>, we typically compute <span class="math inline">\(P\left( \mathbf{X}^\text{i}, \mathbf{X}^\text{c} \mid \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c}, \epsilon \right)\)</span>, which does not suffer from the wrong probability of midline extension, as the distribution over hidden states is renormalized:</p>
<p><span class="math display">\[
P \left( \mathbf{X}^\text{i}, \mathbf{X}^\text{c} \mid \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c}, \epsilon \right) = \frac{P \left( \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c} \mid \mathbf{X}^\text{i}, \mathbf{X}^\text{c}, \epsilon \right) P \left( \mathbf{X}^\text{i}, \mathbf{X}^\text{c}, \epsilon \right)}{P \left( \mathbf{Z}^\text{i}, \mathbf{Z}^\text{c}, \epsilon \right)}
\]</span></p>
<p>Note that a distribution over <span class="math inline">\(\epsilon\)</span> appears both in the enumerator and the denominator, which largely cancel each other, leaving only the midline extension’s effect on the distribution over hidden states in the prediction.</p>
<p>Also, the discrepancy in midline extension prevalence between early and advanced T-category is particularly pronounced in oropharyngeal SCC patients. For example, in oral cavity SCC, the midline extension only increases from 15.4% (20 out of 130) to 33.3% (13 out of 39).</p>
</section>
</section>
<section id="prediction-of-risk-for-occult-disease" class="level2">
<h2>Prediction of Risk for Occult Disease</h2>
<p>In this section, we investigate how the model may be applied clinically: We want to estimate the risk for occult disease in some or all LNLs, given the patient’s individual diagnosis. In terms of our model, this diagnosis consists of the T-category, the lateralization of the tumor (does it extend over the mid-sagittal line?), and which LNLs are clinically involved, e.g. because some lymph nodes appear enlarged in an MRI scan or show increased glycolytic activity on an FDG PET/CT scan.</p>
<div id="fig-model-risks" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-risks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-model-risks.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure 9: Histograms over the predicted risk of occult contralateral LNL II (left), III (middle), and IV (right) invovlement, shown for some combinations of T-category, tumor lateralization, and clinical LNL diagnoses. All LNLs not explicitly mentioned in the legend, including the LNL for which the risk of occult disease was computed, where assumed to be clinically negative."><img src="figures/fig-model-risks.svg" class="img-fluid" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-risks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 9: Histograms over the predicted risk of occult contralateral LNL II (left), III (middle), and IV (right) invovlement, shown for some combinations of T-category, tumor lateralization, and clinical LNL diagnoses. All LNLs not explicitly mentioned in the legend, including the LNL for which the risk of occult disease was computed, where assumed to be clinically negative.
</figcaption>
</figure>
</div>
<p><a href="#fig-model-risks" class="quarto-xref">Figure 9</a> shows this predicted risk of occult disease in the contralateral LNLs II, III, and IV for interesting combinations of these three risk factors. This risk is computed <em>given</em> a CT diagnosis assessing the per-LNL clinical involvement for which we assumed a sensitivity of 81% and a specificity of 76% <span class="citation" data-cites="de_bondt_detection_2007">(<a href="#ref-de_bondt_detection_2007" role="doc-biblioref">De Bondt and Others 2007</a>)</span>.</p>
<section id="contralateral-lnl-ii" class="level3">
<h3>Contralateral LNL II</h3>
<p>The variable impacting the prediction for contralateral level II involvement in our model is the tumor’s lateralization. For example, a patient with a clearly lateralized early T-category tumor and a clinically N0 neck is assigned a 1-2% <!-- TODO: make this dynamic --> risk for occult disease in contralateral LNL II. Under the same scenario, but <em>with</em> mid-sagittal extension, the risk jumps to almost 7%. <!-- TODO: make this dynamic --></p>
<p>T-category plays a lesser role: Considering the scenario of a tumor that crosses the mid-sagittal line and an ipsilateral neck where at least LNL III is clinically involved, the risk for occult contralateral LNL II disease is around 8.5%. <!-- TODO: make this dynamic --> For the same scenario and an advanced T-category tumor, the risk increases to 11%. <!-- TODO: make this dynamic --></p>
<p>Lastly, the predicted risk is also correlated via the time-steps to the degree of ipsilateral involvement. Changing the aforementioned scenario (advanced T-category, midline extension, ipsilateral LNL III clinically involved) to one where the patient presents with a clinically N0 neck, the risk for occult disease in the contralateral LNL II falls from 11% <!-- TODO: make this dynamic --> to 9.5%. <!-- TODO: make this dynamic --></p>
<p>Taken together, T-category and ipsilateral involvement may still considerably impact the risk prediction for contralateral involvement: In <a href="#fig-model-risks" class="quarto-xref">figure 9</a> the scenarios underlying the orange (6.5% <!-- TODO: make this dynamic -->) and the red (11% <!-- TODO: make this dynamic -->) histograms differ in T-category (early vs advanced) and clinical diagnosis (N0 vs ipsilateral at least LNL III involved).</p>
</section>
<section id="contralalteral-lnl-iii" class="level3">
<h3>Contralalteral LNL III</h3>
<p>As shown in the center subplot of <a href="#fig-model-risks" class="quarto-xref">figure 9</a>, the risk for occult disease in the contralateral LNL III only ever crosses a 5% threshold if the upstream level II is involved too, resulting in a risk of 5% to 6%<!-- TODO: make dynamic -->. As long as the contralateral neck appears clinically node negative, however, even an advanced T-category and midline extension do not yield a risk higher than 2%.</p>
</section>
<section id="contralateral-lnl-iv" class="level3">
<h3>Contralateral LNL IV</h3>
<p>Our model’s prediction for the contralateral LNL IV show that even in the most extreme case, with an advanced T-category tumor extending over the mid-sagittal line as well as metastases in every ipsilateral LNL and every contralateral upstream level, the risk does not exceed 5%</p>
</section>
</section>
<section id="sec-discussion" class="level1">
<h1>Discussion</h1>
<section id="summary" class="level2">
<h2>Summary</h2>
<p>In this work we present a formalism to model the ipsi- and contralateral lymphatic involvement of oropharyngeal SCC patients. An ipsilateral model has been previously developed and published <span class="citation" data-cites="ludwig_hidden_2021 ludwig_modelling_2023">(<a href="#ref-ludwig_hidden_2021" role="doc-biblioref">Ludwig et al. 2021</a>; <a href="#ref-ludwig_modelling_2023" role="doc-biblioref">Ludwig, Schubert, Barbatei, Bauwens, Hoffmann, et al. 2023</a>)</span>. Based on this, we introduce an extension that leaves the ipsilateral model untouched, but extends it to the contralateral side in an intuitive and comprehensible manner.</p>
<p>The model’s performance w.r.t. its ability to describe the data on contralateral nodal involvement was evaluated based on a dataset of 833<!-- TODO: make this dynamic --> patients from four institutions. To the best of our knowledge, this is the first time lymphatic tumor progression has been modelled in such detail and to such an extent. While there was work on regional tumor spread, these models were conceptually different, more limited in the LNLs for which they make predictions, and not trained with real patient data <span class="citation" data-cites="benson_markov_2006 jung_development_2017">(<a href="#ref-benson_markov_2006" role="doc-biblioref">Benson, Whipple, and Kalet 2006</a>; <a href="#ref-jung_development_2017" role="doc-biblioref">Jung et al. 2017</a>)</span>.</p>
<p>The model takes the clincal diagnosis of the lymph node levels, the primary tumor’s T-category, as well as lateralization into account when predicting the personalized risk for occult disease in any LNL of interest. Owing to the relatively few parameters, the model is highly interpretable and every parameter can be intuitively explained, while still offering good accuracy in its predictions.</p>
</section>
<section id="implications-for-contralateral-elective-nodal-treatment" class="level2">
<h2>Implications for Contralateral Elective Nodal Treatment</h2>
<p>The predictions of this model are being used to inform a clinical trial on volume deescalation at the University Hospital Zurich [citation needed<!-- TODO: add -->]. When accepting a 5% risk of occult disease in any given LNL, the model suggests the following contralateral elective irradiation (assuming the respective LNL appears clinically healthy):</p>
<ul>
<li>LNL II when the tumor extends over the mid-sagittal line</li>
<li>LNL III when LNL II is clinically, the tumor is of advanced T-category, crosses the midline, and the ipsilateral neck shows involvement of at least LNL II</li>
<li>LNL IV only for severe ipsilateral involvement, advanced T-category with obvious midline extension and contralateral upstream involvement</li>
</ul>
</section>
</section>
<section id="acknowledgement" class="level1 appendix">
<h1 class="appendix">Acknowledgement</h1>
<p>This work was supported by:</p>
<ul>
<li>the Clinical Research Priority Program “Artificial Intelligence in Oncological Imaging” of the University of Zurich</li>
<li>the Swiss Cancer Research Foundation under grant number KFS 5645-08-2022</li>
</ul>
</section>
<section id="contralateral-prevalence-of-involvement" class="level1 appendix">
<h1 class="appendix">Contralateral Prevalence of Involvement</h1>
</section>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode" id="cb5"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lnl_cols <span class="op">=</span> get_lnl_cols(<span class="st">&quot;contra&quot;</span>, lnls<span class="op">=</span>[<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>num_ipsi_inv <span class="op">=</span> raw[get_lnl_cols(<span class="st">&quot;ipsi&quot;</span>)].<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">&quot;columns&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>contra_inv <span class="op">=</span> raw[lnl_cols].copy()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>contra_inv.columns <span class="op">=</span> contra_inv.columns.droplevel([<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>contra_inv[<span class="st">&quot;t_stage&quot;</span>] <span class="op">=</span> raw[COL.t_stage].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">&quot;early&quot;</span> <span class="cf">if</span> x <span class="op">&lt;=</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">&quot;advanced&quot;</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>contra_inv[<span class="st">&quot;ipsi&quot;</span>] <span class="op">=</span> num_ipsi_inv.<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">str</span>(x) <span class="cf">if</span> x <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">&quot;≥ 2&quot;</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>contra_inv[<span class="st">&quot;midext&quot;</span>] <span class="op">=</span> raw[COL.midext]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> contra_inv.groupby(by<span class="op">=</span>[<span class="st">&quot;t_stage&quot;</span>, <span class="st">&quot;ipsi&quot;</span>, <span class="st">&quot;midext&quot;</span>])</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>num_involved <span class="op">=</span> grouped.<span class="bu">sum</span>()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> grouped.count()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>percent_involved <span class="op">=</span> num_involved <span class="op">/</span> total</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> total.index.rename([<span class="st">&quot;T-cat.&quot;</span>, <span class="st">&quot;ipsi&quot;</span>, <span class="st">&quot;Mid. ext.&quot;</span>])</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>total.index <span class="op">=</span> idx</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>num_involved.index <span class="op">=</span> idx</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>percent_involved.index <span class="op">=</span> idx</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>involved <span class="op">=</span> num_involved.join(</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="dv">100</span> <span class="op">*</span> percent_involved,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  rsuffix<span class="op">=</span><span class="st">&quot; (%)&quot;</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>).sort_index(axis<span class="op">=</span><span class="st">&quot;columns&quot;</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>involved.columns <span class="op">=</span> pd.MultiIndex.from_product(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>],</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>   [<span class="st">&quot;n&quot;</span>, <span class="st">&quot;%&quot;</span>]],</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  names<span class="op">=</span>[<span class="st">&quot;LNL&quot;</span>, <span class="st">&quot;&quot;</span>]</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>involved[<span class="st">&quot;total&quot;</span>, <span class="st">&quot;n&quot;</span>] <span class="op">=</span> total[<span class="st">&quot;I&quot;</span>]</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  involved</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  .reset_index()</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  .sort_values(<span class="st">&quot;ipsi&quot;</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  .sort_values(<span class="st">&quot;T-cat.&quot;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  .style</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">format</span>(precision<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">apply</span>(right_align, subset<span class="op">=</span>involved.columns[<span class="dv">0</span>:])</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">apply</span>(highlight_t_stage, subset<span class="op">=</span>[<span class="st">&quot;T-cat.&quot;</span>])</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">apply</span>(highlight_bool, subset<span class="op">=</span>[<span class="st">&quot;Mid. ext.&quot;</span>])</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">apply</span>(highlight, subset<span class="op">=</span>[<span class="st">&quot;ipsi&quot;</span>], mapping<span class="op">=</span>{</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;0&quot;</span>: COLORS[<span class="st">&quot;green&quot;</span>],</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;1&quot;</span>: COLORS[<span class="st">&quot;orange&quot;</span>],</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;≥ 2&quot;</span>: COLORS[<span class="st">&quot;red&quot;</span>],</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  .hide()</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="tbl-data-strat" class="cell quarto-float quarto-figure quarto-figure-center" data-execution_count="6">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-data-strat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 3: Contralateral involvement depending on whether the primary tumor extends over the mid-sagittal line, the T-category, and whether the ipsilateral LNL III was involved or healthy.
</figcaption>
<div aria-describedby="tbl-data-strat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="5">
<style type="text/css">
#T_4ef05_row0_col0, #T_4ef05_row0_col1, #T_4ef05_row0_col2, #T_4ef05_row1_col0, #T_4ef05_row1_col1, #T_4ef05_row2_col0, #T_4ef05_row2_col2, #T_4ef05_row3_col0, #T_4ef05_row4_col0, #T_4ef05_row4_col2, #T_4ef05_row5_col0, #T_4ef05_row6_col1, #T_4ef05_row6_col2, #T_4ef05_row7_col1, #T_4ef05_row8_col2, #T_4ef05_row10_col2 {
  color: #00afa5;
}
#T_4ef05_row0_col3, #T_4ef05_row0_col4, #T_4ef05_row0_col5, #T_4ef05_row0_col6, #T_4ef05_row0_col7, #T_4ef05_row0_col8, #T_4ef05_row0_col9, #T_4ef05_row0_col10, #T_4ef05_row0_col11, #T_4ef05_row1_col3, #T_4ef05_row1_col4, #T_4ef05_row1_col5, #T_4ef05_row1_col6, #T_4ef05_row1_col7, #T_4ef05_row1_col8, #T_4ef05_row1_col9, #T_4ef05_row1_col10, #T_4ef05_row1_col11, #T_4ef05_row2_col3, #T_4ef05_row2_col4, #T_4ef05_row2_col5, #T_4ef05_row2_col6, #T_4ef05_row2_col7, #T_4ef05_row2_col8, #T_4ef05_row2_col9, #T_4ef05_row2_col10, #T_4ef05_row2_col11, #T_4ef05_row3_col3, #T_4ef05_row3_col4, #T_4ef05_row3_col5, #T_4ef05_row3_col6, #T_4ef05_row3_col7, #T_4ef05_row3_col8, #T_4ef05_row3_col9, #T_4ef05_row3_col10, #T_4ef05_row3_col11, #T_4ef05_row4_col3, #T_4ef05_row4_col4, #T_4ef05_row4_col5, #T_4ef05_row4_col6, #T_4ef05_row4_col7, #T_4ef05_row4_col8, #T_4ef05_row4_col9, #T_4ef05_row4_col10, #T_4ef05_row4_col11, #T_4ef05_row5_col3, #T_4ef05_row5_col4, #T_4ef05_row5_col5, #T_4ef05_row5_col6, #T_4ef05_row5_col7, #T_4ef05_row5_col8, #T_4ef05_row5_col9, #T_4ef05_row5_col10, #T_4ef05_row5_col11, #T_4ef05_row6_col3, #T_4ef05_row6_col4, #T_4ef05_row6_col5, #T_4ef05_row6_col6, #T_4ef05_row6_col7, #T_4ef05_row6_col8, #T_4ef05_row6_col9, #T_4ef05_row6_col10, #T_4ef05_row6_col11, #T_4ef05_row7_col3, #T_4ef05_row7_col4, #T_4ef05_row7_col5, #T_4ef05_row7_col6, #T_4ef05_row7_col7, #T_4ef05_row7_col8, #T_4ef05_row7_col9, #T_4ef05_row7_col10, #T_4ef05_row7_col11, #T_4ef05_row8_col3, #T_4ef05_row8_col4, #T_4ef05_row8_col5, #T_4ef05_row8_col6, #T_4ef05_row8_col7, #T_4ef05_row8_col8, #T_4ef05_row8_col9, #T_4ef05_row8_col10, #T_4ef05_row8_col11, #T_4ef05_row9_col3, #T_4ef05_row9_col4, #T_4ef05_row9_col5, #T_4ef05_row9_col6, #T_4ef05_row9_col7, #T_4ef05_row9_col8, #T_4ef05_row9_col9, #T_4ef05_row9_col10, #T_4ef05_row9_col11, #T_4ef05_row10_col3, #T_4ef05_row10_col4, #T_4ef05_row10_col5, #T_4ef05_row10_col6, #T_4ef05_row10_col7, #T_4ef05_row10_col8, #T_4ef05_row10_col9, #T_4ef05_row10_col10, #T_4ef05_row10_col11, #T_4ef05_row11_col3, #T_4ef05_row11_col4, #T_4ef05_row11_col5, #T_4ef05_row11_col6, #T_4ef05_row11_col7, #T_4ef05_row11_col8, #T_4ef05_row11_col9, #T_4ef05_row11_col10, #T_4ef05_row11_col11 {
  text-align: right;
}
#T_4ef05_row1_col2, #T_4ef05_row3_col2, #T_4ef05_row4_col1, #T_4ef05_row5_col1, #T_4ef05_row5_col2, #T_4ef05_row6_col0, #T_4ef05_row7_col0, #T_4ef05_row7_col2, #T_4ef05_row8_col0, #T_4ef05_row9_col0, #T_4ef05_row9_col2, #T_4ef05_row10_col0, #T_4ef05_row10_col1, #T_4ef05_row11_col0, #T_4ef05_row11_col1, #T_4ef05_row11_col2 {
  color: #ae0060;
}
#T_4ef05_row2_col1, #T_4ef05_row3_col1, #T_4ef05_row8_col1, #T_4ef05_row9_col1 {
  color: #f17900;
}
</style>

<table id="T_4ef05" class="do-not-create-environment cell" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_4ef05_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">T-cat.</th>
<th id="T_4ef05_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">ipsi</th>
<th id="T_4ef05_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Mid. ext.</th>
<th colspan="2" id="T_4ef05_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">I</th>
<th colspan="2" id="T_4ef05_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">II</th>
<th colspan="2" id="T_4ef05_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">III</th>
<th colspan="2" id="T_4ef05_level0_col9" class="col_heading level0 col9" data-quarto-table-cell-role="th">IV</th>
<th id="T_4ef05_level0_col11" class="col_heading level0 col11" data-quarto-table-cell-role="th">total</th>
</tr>
<tr class="odd">
<th id="T_4ef05_level1_col0" class="col_heading level1 col0" data-quarto-table-cell-role="th"></th>
<th id="T_4ef05_level1_col1" class="col_heading level1 col1" data-quarto-table-cell-role="th"></th>
<th id="T_4ef05_level1_col2" class="col_heading level1 col2" data-quarto-table-cell-role="th"></th>
<th id="T_4ef05_level1_col3" class="col_heading level1 col3" data-quarto-table-cell-role="th">n</th>
<th id="T_4ef05_level1_col4" class="col_heading level1 col4" data-quarto-table-cell-role="th">%</th>
<th id="T_4ef05_level1_col5" class="col_heading level1 col5" data-quarto-table-cell-role="th">n</th>
<th id="T_4ef05_level1_col6" class="col_heading level1 col6" data-quarto-table-cell-role="th">%</th>
<th id="T_4ef05_level1_col7" class="col_heading level1 col7" data-quarto-table-cell-role="th">n</th>
<th id="T_4ef05_level1_col8" class="col_heading level1 col8" data-quarto-table-cell-role="th">%</th>
<th id="T_4ef05_level1_col9" class="col_heading level1 col9" data-quarto-table-cell-role="th">n</th>
<th id="T_4ef05_level1_col10" class="col_heading level1 col10" data-quarto-table-cell-role="th">%</th>
<th id="T_4ef05_level1_col11" class="col_heading level1 col11" data-quarto-table-cell-role="th">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_4ef05_row0_col0" class="data row0 col0">early</td>
<td id="T_4ef05_row0_col1" class="data row0 col1">0</td>
<td id="T_4ef05_row0_col2" class="data row0 col2">False</td>
<td id="T_4ef05_row0_col3" class="data row0 col3">0</td>
<td id="T_4ef05_row0_col4" class="data row0 col4">0.00</td>
<td id="T_4ef05_row0_col5" class="data row0 col5">1</td>
<td id="T_4ef05_row0_col6" class="data row0 col6">1.16</td>
<td id="T_4ef05_row0_col7" class="data row0 col7">0</td>
<td id="T_4ef05_row0_col8" class="data row0 col8">0.00</td>
<td id="T_4ef05_row0_col9" class="data row0 col9">0</td>
<td id="T_4ef05_row0_col10" class="data row0 col10">0.00</td>
<td id="T_4ef05_row0_col11" class="data row0 col11">86</td>
</tr>
<tr class="even">
<td id="T_4ef05_row1_col0" class="data row1 col0">early</td>
<td id="T_4ef05_row1_col1" class="data row1 col1">0</td>
<td id="T_4ef05_row1_col2" class="data row1 col2">True</td>
<td id="T_4ef05_row1_col3" class="data row1 col3">0</td>
<td id="T_4ef05_row1_col4" class="data row1 col4">0.00</td>
<td id="T_4ef05_row1_col5" class="data row1 col5">1</td>
<td id="T_4ef05_row1_col6" class="data row1 col6">10.00</td>
<td id="T_4ef05_row1_col7" class="data row1 col7">1</td>
<td id="T_4ef05_row1_col8" class="data row1 col8">10.00</td>
<td id="T_4ef05_row1_col9" class="data row1 col9">0</td>
<td id="T_4ef05_row1_col10" class="data row1 col10">0.00</td>
<td id="T_4ef05_row1_col11" class="data row1 col11">10</td>
</tr>
<tr class="odd">
<td id="T_4ef05_row2_col0" class="data row2 col0">early</td>
<td id="T_4ef05_row2_col1" class="data row2 col1">1</td>
<td id="T_4ef05_row2_col2" class="data row2 col2">False</td>
<td id="T_4ef05_row2_col3" class="data row2 col3">1</td>
<td id="T_4ef05_row2_col4" class="data row2 col4">0.53</td>
<td id="T_4ef05_row2_col5" class="data row2 col5">11</td>
<td id="T_4ef05_row2_col6" class="data row2 col6">5.82</td>
<td id="T_4ef05_row2_col7" class="data row2 col7">2</td>
<td id="T_4ef05_row2_col8" class="data row2 col8">1.06</td>
<td id="T_4ef05_row2_col9" class="data row2 col9">1</td>
<td id="T_4ef05_row2_col10" class="data row2 col10">0.53</td>
<td id="T_4ef05_row2_col11" class="data row2 col11">189</td>
</tr>
<tr class="even">
<td id="T_4ef05_row3_col0" class="data row3 col0">early</td>
<td id="T_4ef05_row3_col1" class="data row3 col1">1</td>
<td id="T_4ef05_row3_col2" class="data row3 col2">True</td>
<td id="T_4ef05_row3_col3" class="data row3 col3">1</td>
<td id="T_4ef05_row3_col4" class="data row3 col4">11.11</td>
<td id="T_4ef05_row3_col5" class="data row3 col5">2</td>
<td id="T_4ef05_row3_col6" class="data row3 col6">22.22</td>
<td id="T_4ef05_row3_col7" class="data row3 col7">0</td>
<td id="T_4ef05_row3_col8" class="data row3 col8">0.00</td>
<td id="T_4ef05_row3_col9" class="data row3 col9">0</td>
<td id="T_4ef05_row3_col10" class="data row3 col10">0.00</td>
<td id="T_4ef05_row3_col11" class="data row3 col11">9</td>
</tr>
<tr class="odd">
<td id="T_4ef05_row4_col0" class="data row4 col0">early</td>
<td id="T_4ef05_row4_col1" class="data row4 col1">≥ 2</td>
<td id="T_4ef05_row4_col2" class="data row4 col2">False</td>
<td id="T_4ef05_row4_col3" class="data row4 col3">1</td>
<td id="T_4ef05_row4_col4" class="data row4 col4">0.96</td>
<td id="T_4ef05_row4_col5" class="data row4 col5">15</td>
<td id="T_4ef05_row4_col6" class="data row4 col6">14.42</td>
<td id="T_4ef05_row4_col7" class="data row4 col7">3</td>
<td id="T_4ef05_row4_col8" class="data row4 col8">2.88</td>
<td id="T_4ef05_row4_col9" class="data row4 col9">3</td>
<td id="T_4ef05_row4_col10" class="data row4 col10">2.88</td>
<td id="T_4ef05_row4_col11" class="data row4 col11">104</td>
</tr>
<tr class="even">
<td id="T_4ef05_row5_col0" class="data row5 col0">early</td>
<td id="T_4ef05_row5_col1" class="data row5 col1">≥ 2</td>
<td id="T_4ef05_row5_col2" class="data row5 col2">True</td>
<td id="T_4ef05_row5_col3" class="data row5 col3">0</td>
<td id="T_4ef05_row5_col4" class="data row5 col4">0.00</td>
<td id="T_4ef05_row5_col5" class="data row5 col5">3</td>
<td id="T_4ef05_row5_col6" class="data row5 col6">30.00</td>
<td id="T_4ef05_row5_col7" class="data row5 col7">4</td>
<td id="T_4ef05_row5_col8" class="data row5 col8">40.00</td>
<td id="T_4ef05_row5_col9" class="data row5 col9">1</td>
<td id="T_4ef05_row5_col10" class="data row5 col10">10.00</td>
<td id="T_4ef05_row5_col11" class="data row5 col11">10</td>
</tr>
<tr class="odd">
<td id="T_4ef05_row6_col0" class="data row6 col0">advanced</td>
<td id="T_4ef05_row6_col1" class="data row6 col1">0</td>
<td id="T_4ef05_row6_col2" class="data row6 col2">False</td>
<td id="T_4ef05_row6_col3" class="data row6 col3">0</td>
<td id="T_4ef05_row6_col4" class="data row6 col4">0.00</td>
<td id="T_4ef05_row6_col5" class="data row6 col5">2</td>
<td id="T_4ef05_row6_col6" class="data row6 col6">5.88</td>
<td id="T_4ef05_row6_col7" class="data row6 col7">0</td>
<td id="T_4ef05_row6_col8" class="data row6 col8">0.00</td>
<td id="T_4ef05_row6_col9" class="data row6 col9">0</td>
<td id="T_4ef05_row6_col10" class="data row6 col10">0.00</td>
<td id="T_4ef05_row6_col11" class="data row6 col11">34</td>
</tr>
<tr class="even">
<td id="T_4ef05_row7_col0" class="data row7 col0">advanced</td>
<td id="T_4ef05_row7_col1" class="data row7 col1">0</td>
<td id="T_4ef05_row7_col2" class="data row7 col2">True</td>
<td id="T_4ef05_row7_col3" class="data row7 col3">0</td>
<td id="T_4ef05_row7_col4" class="data row7 col4">0.00</td>
<td id="T_4ef05_row7_col5" class="data row7 col5">3</td>
<td id="T_4ef05_row7_col6" class="data row7 col6">12.50</td>
<td id="T_4ef05_row7_col7" class="data row7 col7">0</td>
<td id="T_4ef05_row7_col8" class="data row7 col8">0.00</td>
<td id="T_4ef05_row7_col9" class="data row7 col9">0</td>
<td id="T_4ef05_row7_col10" class="data row7 col10">0.00</td>
<td id="T_4ef05_row7_col11" class="data row7 col11">24</td>
</tr>
<tr class="odd">
<td id="T_4ef05_row8_col0" class="data row8 col0">advanced</td>
<td id="T_4ef05_row8_col1" class="data row8 col1">1</td>
<td id="T_4ef05_row8_col2" class="data row8 col2">False</td>
<td id="T_4ef05_row8_col3" class="data row8 col3">0</td>
<td id="T_4ef05_row8_col4" class="data row8 col4">0.00</td>
<td id="T_4ef05_row8_col5" class="data row8 col5">3</td>
<td id="T_4ef05_row8_col6" class="data row8 col6">4.55</td>
<td id="T_4ef05_row8_col7" class="data row8 col7">0</td>
<td id="T_4ef05_row8_col8" class="data row8 col8">0.00</td>
<td id="T_4ef05_row8_col9" class="data row8 col9">0</td>
<td id="T_4ef05_row8_col10" class="data row8 col10">0.00</td>
<td id="T_4ef05_row8_col11" class="data row8 col11">66</td>
</tr>
<tr class="even">
<td id="T_4ef05_row9_col0" class="data row9 col0">advanced</td>
<td id="T_4ef05_row9_col1" class="data row9 col1">1</td>
<td id="T_4ef05_row9_col2" class="data row9 col2">True</td>
<td id="T_4ef05_row9_col3" class="data row9 col3">1</td>
<td id="T_4ef05_row9_col4" class="data row9 col4">1.64</td>
<td id="T_4ef05_row9_col5" class="data row9 col5">18</td>
<td id="T_4ef05_row9_col6" class="data row9 col6">29.51</td>
<td id="T_4ef05_row9_col7" class="data row9 col7">5</td>
<td id="T_4ef05_row9_col8" class="data row9 col8">8.20</td>
<td id="T_4ef05_row9_col9" class="data row9 col9">1</td>
<td id="T_4ef05_row9_col10" class="data row9 col10">1.64</td>
<td id="T_4ef05_row9_col11" class="data row9 col11">61</td>
</tr>
<tr class="odd">
<td id="T_4ef05_row10_col0" class="data row10 col0">advanced</td>
<td id="T_4ef05_row10_col1" class="data row10 col1">≥ 2</td>
<td id="T_4ef05_row10_col2" class="data row10 col2">False</td>
<td id="T_4ef05_row10_col3" class="data row10 col3">4</td>
<td id="T_4ef05_row10_col4" class="data row10 col4">5.26</td>
<td id="T_4ef05_row10_col5" class="data row10 col5">16</td>
<td id="T_4ef05_row10_col6" class="data row10 col6">21.05</td>
<td id="T_4ef05_row10_col7" class="data row10 col7">7</td>
<td id="T_4ef05_row10_col8" class="data row10 col8">9.21</td>
<td id="T_4ef05_row10_col9" class="data row10 col9">4</td>
<td id="T_4ef05_row10_col10" class="data row10 col10">5.26</td>
<td id="T_4ef05_row10_col11" class="data row10 col11">76</td>
</tr>
<tr class="even">
<td id="T_4ef05_row11_col0" class="data row11 col0">advanced</td>
<td id="T_4ef05_row11_col1" class="data row11 col1">≥ 2</td>
<td id="T_4ef05_row11_col2" class="data row11 col2">True</td>
<td id="T_4ef05_row11_col3" class="data row11 col3">3</td>
<td id="T_4ef05_row11_col4" class="data row11 col4">3.80</td>
<td id="T_4ef05_row11_col5" class="data row11 col5">46</td>
<td id="T_4ef05_row11_col6" class="data row11 col6">58.23</td>
<td id="T_4ef05_row11_col7" class="data row11 col7">18</td>
<td id="T_4ef05_row11_col8" class="data row11 col8">22.78</td>
<td id="T_4ef05_row11_col9" class="data row11 col9">8</td>
<td id="T_4ef05_row11_col10" class="data row11 col10">10.13</td>
<td id="T_4ef05_row11_col11" class="data row11 col11">79</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div id="feee7502" class="cell markdown">
<section id="marginalizing-beta-posteriors-over-unknowns" class="level1 appendix">
<h1 class="appendix">Marginalizing Beta Posteriors over Unknowns</h1>
</section>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scripts <span class="im">import</span> shared, COL</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> shared.get_data()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>is_early <span class="op">=</span> data[COL.t_stage].isin([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>reduced <span class="op">=</span> pd.DataFrame({</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Midline Extension&quot;</span>: data.loc[is_early, COL.midext],</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;contra LNL II&quot;</span>: data.loc[is_early, (<span class="st">&quot;max_llh&quot;</span>, <span class="st">&quot;contra&quot;</span>, <span class="st">&quot;II&quot;</span>)]</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> (</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  reduced</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  .fillna(<span class="st">&quot;unknown&quot;</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  .value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  .unstack(<span class="st">&quot;Midline Extension&quot;</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  .rename(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>{</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      <span class="va">False</span>: <span class="st">&quot;healthy&quot;</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="va">True</span>: <span class="st">&quot;involved&quot;</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      <span class="va">False</span>: <span class="st">&quot;no&quot;</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      <span class="va">True</span>: <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>result.loc[<span class="st">&quot;total&quot;</span>] <span class="op">=</span> result.<span class="bu">sum</span>()</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<div id="tbl-data-unknowns" class="cell quarto-float quarto-figure quarto-figure-center" data-execution_count="7">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-data-unknowns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 4: Combinations of midline extension status and state of contralateral LNL II for early T-category patients.
</figcaption>
<div aria-describedby="tbl-data-unknowns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe do-not-create-environment cell" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th">Midline Extension</th>
<th data-quarto-table-cell-role="th">no</th>
<th data-quarto-table-cell-role="th">yes</th>
<th data-quarto-table-cell-role="th">unknown</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">contra LNL II</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">healthy</td>
<td>352</td>
<td>23</td>
<td>59</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">involved</td>
<td>27</td>
<td>6</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">total</td>
<td>379</td>
<td>29</td>
<td>65</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div id="68773408" class="cell markdown">
<p>In <a href="#sec-prevalence" class="quarto-xref">section 5.3</a> we explained that we compare the predicted prevalence of an involvement pattern under a scenario to a beta posterior over the “true” prevalence given the observations in the data. However, our data contains incomplete observations, especially regarding the tumor’s midline extension. This information is not present for a large group of 85 patients, most of which treated at the Centre Léon Bérard in France.</p>
<p>To account for this missing information and plot the correct posteriors over the data prevalence, we need to marginalize over the possible combinations of matching involvement patterns and selected patients under a scenario. For example, we have only 29<!-- TODO: compute dynamically --> early T-category patients with midline extension. But for an additional 65<!-- TODO: compute dynamically --> patients we do not know whether the tumor crossed the mid-sagittal plane. If we now want to compute the prevalence of contralateral LNL II invovlement for these early T-category patients with midline extension, then we need to account for the possibility that we are missing information.</p>
<p>In <a href="#tbl-data-unknowns" class="quarto-xref">table 4</a> we show the combinations of the midline extension status and state of the contralateral LNL II. Using only available information, we would get to 6 out of 29<!-- TODO: compute dynamically --> patients for the prevalence of contralateral LNL II invovlement among the early T-category patients with midline extension. But the column with the “unknown” numbers suggests that the true prevalence could range from 6 out of 29 + 59 (7%)<!-- TODO: compute dynamically --> up to 12 out of 29 + 6 (34%)<!-- TODO: compute dynamically -->. We assume that every one of the possible combinations has the same a priori probability (uniform prior) but we do need to account for permutations via the binomial factor. In general, let us say we have <span class="math inline">\(n\)</span> patients with midline extension, of which <span class="math inline">\(k\)</span> harbor metastases in the contralateral LNL II. And we have <span class="math inline">\(m\)</span> patients with unknown midline extension, of which <span class="math inline">\(\ell\)</span> presented with diasease in contralateral LNL II, then the posterior distribution - marginalized over the unknown data - over the true prevalence <span class="math inline">\(x \in \left[ 0, 1 \right]\)</span> is given by:</p>
<p><span class="math display">\[
p(x \mid n, k, m, \ell, \alpha, \beta) = \left[ \frac{1}{m} \sum_{i=0}^m \frac{1}{\min(i,\ell)} \sum_{j=0}^{\min(i,\ell)} \frac{P(i, j \mid x )}{\binom{n}{k}} \right] \cdot P(n, k \mid x) \cdot \frac{1}{\operatorname{B}(\alpha, \beta)} x^\alpha (1-x)^\beta
\]</span></p>
<p>Note the two binomial likelihoods: one being marginalized over and one acting implicitly as a prior to the summed terms. This role of the likelihood over the data with known midline extension as a prior to the part where that data is missing corrects for the fact that there are highly unlikely combinations among those we marginalize over. E.g., expecting that exactly those 6 patients with contralateral LNL II involvemnt are also coincidentially the only ones of the 65 with a tumor crossing the mid-sagittal line is very unlikely. This is accounted for by the fact that this possibility has only one permutation and it is weakened by the likelihood over the data with known midline extension. With a uniform prior beta distribution (<span class="math inline">\(\alpha=1\)</span> and <span class="math inline">\(\beta=1\)</span>), the above simplifies to:</p>
<p><span class="math display">\[
p(x \mid n, k, m, \ell) = \left[ \frac{1}{m} \sum_{i=0}^m \frac{1}{\min(i,\ell)} \sum_{j=0}^{\min(i,\ell)} \binom{n+i}{k+j} x^j (1 - x)^{i-j} \right] \cdot x^{k+1} (1 - x)^{n-k+1}
\]</span></p>
<p>We have plotted this marginal in <a href="#fig-model-marginal-pdf" class="quarto-xref">figure 10</a> (blue curve) and the terms that make up the above sum (light red curves). Note that we weighted the plotting opacity with the number of permutations each of the possible combinations has. The marginal is compared against the “naive” beta posterior that only takes the data into account for which midline extension is available (green curve).</p>
<div id="fig-model-marginal-pdf" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-model-marginal-pdf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figures/fig-model-marginal-pdf.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure 10: Posterior distributions over the data prevalence for contralateral LNL II involvement under the scenario of early T-category and midline extension. The green beta distribution shows this prevalence for those patients for which midline extension is known. While the blue PDF is a marginal distribution summed over all possible combinations, which are shown in shades of red. The more permutations a particular combination has, the more opaque it is plotted."><img src="figures/fig-model-marginal-pdf.svg" class="img-fluid" style="width:50.0%" /></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model-marginal-pdf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 10: Posterior distributions over the data prevalence for contralateral LNL II involvement under the scenario of early T-category and midline extension. The green beta distribution shows this prevalence for those patients for which midline extension is known. While the blue PDF is a marginal distribution summed over all possible combinations, which are shown in shades of red. The more permutations a particular combination has, the more opaque it is plotted.
</figcaption>
</figure>
</div>
<p>The distribution that marginalizes over the unknown midline extension cases is shifted towards a lower prevalence. This makes intuitive sense: With only 6 patients among the 65 with unknown midline extension status, the upper bound for the prevalence has moved down compared to 6 out of 29.</p>
<p>We chose to compare our model against such corrected prevalence posteriors, because the model, too, is capable of marginalizing over unknown midline extension in the data. It would therefore be inaccurate to compare the model trained with the full dataset to only that part of the patient cohort where the tumor lateralization was recorded.</p>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-benson_markov_2006" class="csl-entry" role="listitem">
Benson, Noah, Mark Whipple, and Ira J Kalet. 2006. <span>“A <span>Markov</span> Model Approach to Predicting Regional Tumor Spread in the Lymphatic System of the Head and Neck.”</span> <em>AMIA ... Annual Symposium Proceedings. AMIA Symposium</em>, 31–35.
</div>
<div id="ref-biau_selection_2019" class="csl-entry" role="listitem">
Biau, Julian, Michel Lapeyre, Idriss Troussier, Wilfried Budach, Jordi Giralt, Cai Grau, Joanna Kazmierska, et al. 2019. <span>“Selection of Lymph Node Target Volumes for Definitive Head and Neck Radiation Therapy: A 2019 <span>Update</span>.”</span> <em>Radiotherapy and Oncology</em> 134 (May): 1–9. <a href="https://doi.org/10.1016/j.radonc.2019.01.018">https://doi.org/10.1016/j.radonc.2019.01.018</a>.
</div>
<div id="ref-chao_determination_2002" class="csl-entry" role="listitem">
Chao, K. S.Clifford, Franz J Wippold, Gokhan Ozyigit, Binh N Tran, and James F Dempsey. 2002. <span>“Determination and Delineation of Nodal Target Volumes for Head-and-Neck Cancer Based on Patterns of Failure in Patients Receiving Definitive and Postoperative <span>IMRT</span>.”</span> <em>International Journal of Radiation Oncology*Biology*Physics</em> 53 (5): 1174–84. <a href="https://doi.org/10.1016/S0360-3016(02)02881-X">https://doi.org/10.1016/S0360-3016(02)02881-X</a>.
</div>
<div id="ref-de_bondt_detection_2007" class="csl-entry" role="listitem">
De Bondt, R, and Others. 2007. <span>“Detection of Lymph Node Metastases in Head and Neck Cancer: A Meta-Analysis Comparing <span>US</span>, <span>USgFNAC</span>, <span>CT</span> and <span>MR</span> Imaging.”</span> <em>Eur. J. Radiol.</em> 64: 266–72. <a href="https://doi.org/10.1016/j.ejrad.2007.02.037">https://doi.org/10.1016/j.ejrad.2007.02.037</a>.
</div>
<div id="ref-eisbruch_intensity-modulated_2002" class="csl-entry" role="listitem">
Eisbruch, Avraham, Robert L. Foote, Brian O’Sullivan, Jonathan J. Beitler, and Bhadrasain Vikram. 2002. <span>“Intensity-Modulated Radiation Therapy for Head and Neck Cancer: <span>Emphasis</span> on the Selection and Delineation of the Targets.”</span> <em>Seminars in Radiation Oncology</em> 12 (3): 238–49. <a href="https://doi.org/10.1053/srao.2002.32435">https://doi.org/10.1053/srao.2002.32435</a>.
</div>
<div id="ref-ferlito_elective_2009" class="csl-entry" role="listitem">
Ferlito, Alfio, Carl E. Silver, and Alessandra Rinaldo. 2009. <span>“Elective Management of the Neck in Oral Cavity Squamous Carcinoma: Current Concepts Supported by Prospective Studies.”</span> <em>British Journal of Oral and Maxillofacial Surgery</em> 47 (1): 5–9. <a href="https://doi.org/10.1016/j.bjoms.2008.06.001">https://doi.org/10.1016/j.bjoms.2008.06.001</a>.
</div>
<div id="ref-foreman-mackey_emcee_2013" class="csl-entry" role="listitem">
Foreman-Mackey, Daniel, David W. Hogg, Dustin Lang, and Jonathan Goodman. 2013. <span>“Emcee: <span>The MCMC Hammer</span>.”</span> <em><span>\</span>Pasp</em> 125 (925): 306. <a href="https://doi.org/10.1086/670067">https://doi.org/10.1086/670067</a>.
</div>
<div id="ref-gregoire_delineation_2014" class="csl-entry" role="listitem">
Grégoire, Vincent, Kian Ang, Wilfried Budach, Cai Grau, Marc Hamoir, Johannes A. Langendijk, Anne Lee, et al. 2014. <span>“Delineation of the Neck Node Levels for Head and Neck Tumors: <span>A</span> 2013 Update. <span>DAHANCA</span>, <span>EORTC</span>, <span>HKNPCSG</span>, <span>NCIC CTG</span>, <span>NCRI</span>, <span>RTOG</span>, <span>TROG</span> Consensus Guidelines.”</span> <em>Radiotherapy and Oncology</em> 110 (1): 172–81. <a href="https://doi.org/10.1016/j.radonc.2013.10.010">https://doi.org/10.1016/j.radonc.2013.10.010</a>.
</div>
<div id="ref-gregoire_ct-based_2003" class="csl-entry" role="listitem">
Grégoire, Vincent, Peter Levendag, Kian K. Ang, Jacques Bernier, Marijel Braaksma, Volker Budach, Cliff Chao, et al. 2003. <span>“<span class="nocase">CT-based</span> Delineation of Lymph Node Levels and Related <span>CTVs</span> in the Node-Negative Neck: <span>DAHANCA</span>, <span>EORTC</span>, <span>GORTEC</span>, <span>NCIC</span>,<span>RTOG</span> Consensus Guidelines.”</span> <em>Radiotherapy and Oncology</em> 69 (3): 227–36. <a href="https://doi.org/10.1016/j.radonc.2003.09.011">https://doi.org/10.1016/j.radonc.2003.09.011</a>.
</div>
<div id="ref-gregoire_delineation_2018" class="csl-entry" role="listitem">
Grégoire, V, and Others. 2018. <span>“Delineation of the Primary Tumour Clinical Target Volumes (<span>CTV-P</span>) in Laryngeal, Hypopharyngeal, Oropharyngeal and Oral Cavity Squamous Cell Carcinoma: <span>AIRO</span>, <span>CACA</span>, <span>DAHANCA</span>, <span>EORTC</span>, <span>GEORCC</span>, <span>GORTEC</span>, <span>HKNPCSG</span>, <span>HNCIG</span>, <span>IAG-KHT</span>, <span>LPRHHT</span>, <span>NCIC CTG</span>, <span>NCRI</span>, <span>NRG Oncology</span>, <span>PHNS</span>, <span>SBRT</span>, <span>SOMERA</span>, <span>SRO</span>, <span>SSHNO</span>, <span>TROG</span> Consensus Guidelines.”</span> <em>Radiother. Oncol.</em> 126: 3–24. <a href="https://doi.org/10.1016/j.radonc.2017.10.016">https://doi.org/10.1016/j.radonc.2017.10.016</a>.
</div>
<div id="ref-jung_development_2017" class="csl-entry" role="listitem">
Jung, Hyunggu, Anthony Law, Eli Grunblatt, Lucy L. Wang, Aaron Kusano, Jose L. V. Mejino, and Mark E. Whipple. 2017. <span>“<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5333213">Development of a <span>Novel Markov Chain Model</span> for the <span>Prediction</span> of <span>Head</span> and <span>Neck Squamous Cell Carcinoma Dissemination</span></a>.”</span> <em>AMIA Annual Symposium Proceedings</em> 2016 (February): 1832–39.
</div>
<div id="ref-kyzas_18f-fluorodeoxyglucose_2008" class="csl-entry" role="listitem">
Kyzas, P A, and Others. 2008. <span>“<span class="nocase">18F-fluorodeoxyglucose</span> Positron Emission Tomography to Evaluate Cervical Node Metastases in Patients with Head and Neck Squamous Cell Carcinoma: A Meta-Analysis.”</span> <em>J. Natl Cancer Inst.</em> 100: 712–20. <a href="https://doi.org/10.1093/jnci/djn125">https://doi.org/10.1093/jnci/djn125</a>.
</div>
<div id="ref-ludwig_dataset_2022" class="csl-entry" role="listitem">
Ludwig, Roman, Jean-Marc Hoffmann, Bertrand Pouymayou, Grégoire Morand, Martina Broglie Däppen, Matthias Guckenberger, Vincent Grégoire, Panagiotis Balermpas, and Jan Unkelbach. 2022. <span>“A Dataset on Patient-Individual Lymph Node Involvement in Oropharyngeal Squamous Cell Carcinoma.”</span> <em>Data in Brief</em> 43 (August): 108345. <a href="https://doi.org/10.1016/j.dib.2022.108345">https://doi.org/10.1016/j.dib.2022.108345</a>.
</div>
<div id="ref-ludwig_hidden_2021" class="csl-entry" role="listitem">
Ludwig, Roman, Bertrand Pouymayou, Panagiotis Balermpas, and Jan Unkelbach. 2021. <span>“A Hidden <span>Markov</span> Model for Lymphatic Tumor Progression in the Head and Neck.”</span> <em>Scientific Reports</em> 11 (1): 12261. <a href="https://doi.org/10.1038/s41598-021-91544-1">https://doi.org/10.1038/s41598-021-91544-1</a>.
</div>
<div id="ref-ludwig_modelling_2023" class="csl-entry" role="listitem">
Ludwig, Roman, Adrian Schubert, Dorothea Barbatei, Lauence Bauwens, Jean-Marc Hoffmann, Sandrine Werlen, Olgun Elicin, et al. 2023. <span>“Modelling the <span>Lymphatic Metastatic Progression Pathways</span> of <span>OPSCC</span> from <span>Multi-Institutional Datasets</span>.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2312.11270">https://doi.org/10.48550/arXiv.2312.11270</a>.
</div>
<div id="ref-ludwig_multi-centric_2023" class="csl-entry" role="listitem">
Ludwig, Roman, Adrian Schubert, Dorothea Barbatei, Laurence Bauwens, Sandrine Werlen, Olgun Elicin, Matthias Dettmer, et al. 2023. <span>“A Multi-Centric Dataset on Patient-Individual Pathological Lymph Node Involvement in Head and Neck Squamous Cell Carcinoma.”</span> <em>Data in Brief</em>, December, 110020. <a href="https://doi.org/10.1016/j.dib.2023.110020">https://doi.org/10.1016/j.dib.2023.110020</a>.
</div>
<div id="ref-nelson_run_2013" class="csl-entry" role="listitem">
Nelson, Benjamin, Eric B. Ford, and Matthew J. Payne. 2013. <span>“<span>RUN DMC</span>: <span>AN EFFICIENT</span>, <span>PARALLEL CODE FOR ANALYZING RADIAL VELOCITY OBSERVATIONS USING</span> <span><em>N</em></span> -<span>BODY INTEGRATIONS AND DIFFERENTIAL EVOLUTION MARKOV CHAIN MONTE CARLO</span>.”</span> <em>The Astrophysical Journal Supplement Series</em> 210 (1): 11. <a href="https://doi.org/10.1088/0067-0049/210/1/11">https://doi.org/10.1088/0067-0049/210/1/11</a>.
</div>
<div id="ref-pouymayou_bayesian_2019" class="csl-entry" role="listitem">
Pouymayou, Bertrand, Panagiotis Balermpas, Oliver Riesterer, Matthias Guckenberger, and Jan Unkelbach. 2019. <span>“A <span>Bayesian</span> Network Model of Lymphatic Tumor Progression for Personalized Elective <span>CTV</span> Definition in Head and Neck Cancers.”</span> <em>Physics in Medicine &amp; Biology</em> 64 (16): 165003. <a href="https://doi.org/10.1088/1361-6560/ab2a18">https://doi.org/10.1088/1361-6560/ab2a18</a>.
</div>
<div id="ref-sanguineti_defining_2009" class="csl-entry" role="listitem">
Sanguineti, G, and Others. 2009. <span>“Defining the Risk of Involvement for Each Neck Nodal Level in Patients with Early <span class="nocase">T-stage</span> Node-Positive Oropharyngeal Carcinoma.”</span> <em>Int. J. Radiat. Oncol. Biol. Phys.</em> 74: 1356–64. <a href="https://doi.org/10.1016/j.ijrobp.2008.10.018">https://doi.org/10.1016/j.ijrobp.2008.10.018</a>.
</div>
<div id="ref-ter_braak_differential_2008" class="csl-entry" role="listitem">
ter Braak, Cajo J. F., and Jasper A. Vrugt. 2008. <span>“Differential <span>Evolution Markov Chain</span> with Snooker Updater and Fewer Chains.”</span> <em>Statistics and Computing</em> 18 (4): 435–46. <a href="https://doi.org/10.1007/s11222-008-9104-9">https://doi.org/10.1007/s11222-008-9104-9</a>.
</div>
<div id="ref-vorwerk_guidelines_2011" class="csl-entry" role="listitem">
Vorwerk, Hilke, and Clemens F. Hess. 2011. <span>“Guidelines for Delineation of Lymphatic Clinical Target Volumes for High Conformal Radiotherapy: Head and Neck Region.”</span> <em>Radiation Oncology</em> 6 (1): 97. <a href="https://doi.org/10.1186/1748-717X-6-97">https://doi.org/10.1186/1748-717X-6-97</a>.
</div>
</div>
     </main>
<!-- /main column -->  <script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"descPosition":"bottom","closeEffect":"zoom","loop":false,"openEffect":"zoom","selector":".lightbox"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script> 
  </body>
</html>